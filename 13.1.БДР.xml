<?xml version="1.0" encoding="UTF-8"?>
<HBRRepo>
  <variables>
    <variable id="1" name="ГОД" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Year</property>
      <property name="prompt_text">Выберите Год</property>
      <property name="scope">ruleset</property>
      <value>FY18</value>
    </variable>
    <variable id="2" name="ВЕРСИЯ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Version</property>
      <property name="prompt_text">Выберите Версию</property>
      <property name="scope">ruleset</property>
      <value>Рабочая_1</value>
    </variable>
    <variable id="3" name="СЦЕНАРИЙ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Scenario</property>
      <property name="prompt_text">Выберите Сценарий</property>
      <property name="scope">ruleset</property>
      <value>Проект</value>
    </variable>
    <variable id="4" name="МВЗ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">МВЗ</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите МВЗ</property>
      <property name="scope">ruleset</property>
      <value>"Итого по МВЗ"</value>
    </variable>
  </variables>
  <rulesets></rulesets>
  <rules>
    <rule id="1" name="13.1.БДР" product="Planning">
      <property name="description">Перенос Инвестиций и Кредитов для ФП</property>
      <property name="application">ТЧМ</property>
      <property name="plantype">Plan1</property>
      <property name="display_label">13.1.БДР</property>
      <property name="enablePostProcessing">false</property>
      <property name="enablePreProcessing">false</property>
      <variable_references>
        <variable_reference id="2" name="ВЕРСИЯ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.1.БДР</property>
          <property name="seq">1</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="3" name="СЦЕНАРИЙ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.1.БДР</property>
          <property name="seq">2</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="1" name="ГОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.1.БДР</property>
          <property name="seq">3</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="4" name="МВЗ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.1.БДР</property>
          <property name="seq">4</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
      </variable_references>
      <script><![CDATA[SET AGGMISSG ON;
SET UPDATECALC OFF;
SET CREATEBLOCKONEQ OFF;
SET CREATENONMISSINGBLK OFF;
SET FRMLBOTTOMUP OFF;
SET REMOTECALC OFF;
SET CALCPARALLEL 1;
SET CALCTASKDIMS 1;
SET EMPTYMEMBERSETS ON;
SET FRMLRTDYNAMIC OFF;
SET MSG INFO;
/* Проверка корректности рассчитываемого среза данных */

FIX(
/* ВАЛЮТА							*/	"бу валюты"
/* ПЕРИОД							*/	"P0"
/* ГОД								*/	"No Year"
/* ВЕРСИЯ							*/	
/* СЦЕНАРИЙ							*/	
/* ЦФО								*/	"бу ЦФО"
/* МВЗ								*/	"бу МВЗ"
/* МВЗ ПОЛУЧАТЕЛЬ					*/	"бу МВЗ (пол-ль)"
/* СЧЕТА БАЛАНСА					*/	"80_Увеличение"
/* СТАТЬИ							*/	
/* ПОКАЗАТЕЛИ						*/	"Сумма"
/* ВИД ЗАТРАТ						*/	"бу видов затрат"
/* ПРОДУКЦИЯ						*/	"бу вида продукции"
/* КОНТРАГЕНТЫ						*/	"бу контрагента"
/* НАПРАВЛЕНИЕ	*/	"бу направления"
/* ЭЛЕМЕНТЫ_ЗАТРАТ					*/	"бу элемента затрат"
/* ПРОЧЕЕ							*/	"бу прочих справочников"

)
  SET CREATENONMISSINGBLK ON;

  
  var ErrFlagScenario=0;
  var ErrFlagVersion=0;
  var NextM=2;
  /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА СЦЕНАРИЯ */
  FIX(/* Сценарий */ {СЦЕНАРИЙ} AND @LIST(&ОТКРЫТЫЕ_СЦЕНАРИИ))
    FIX(
    /* Сценарий */ 
    /* Версия   */ "Рабочая 1"
    )
     "бу статьи" (
     IF (ErrFlagScenario==0)
            ErrFlagScenario=1;
     ENDIF
     );

    ENDFIX
  ENDFIX

   /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА ВЕРСИИ */
  FIX(/* Версия  */ {ВЕРСИЯ} AND @LIST(&ОТКРЫТЫЕ_ВЕРСИИ))
    FIX(
    /* Сценарий */ "Проект"
    /* Версия   */ 
    )
     "бу статьи" (
     IF (ErrFlagVersion==0)
            ErrFlagVersion=1;
     ENDIF
     );
    ENDFIX
  ENDFIX

  /* ВЫВОД СООБЩЕНИЙ О НЕКОРРЕКТНОМ СРЕЗЕ */
  FIX(
  /* Сценарий     */ "Проект"
  /* Версия       */ "Рабочая 1"
  )

   "бу статьи" (
    IF (ErrFlagScenario==0)
       @RETURN("Выбран сценарий, закрытый для расчета. Расчет не произведен.",ERROR);
    ENDIF
    IF (ErrFlagVersion==0)
       @RETURN("Выбрана версия, закрытая для расчета. Расчет не произведен.",ERROR);
    ENDIF
    )

   ENDFIX
ENDFIX
SET CREATENONMISSINGBLK OFF;
/*Агрегируем поолную себестоимость*/

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 	 					 */"бу направления"
/*ПРОЧЕЕ 							 */
/*СЧЕТА БАЛАНСА                      */@RELATIVE("Начисление",0)
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */
/*СТАТЬИ							  */@RELATIVE("ПОЛНАЯ СЕБЕСТОИМОСТЬ",0)
/*СЦЕНАРИЙ							  */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Итого год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								  */{ГОД}
/*ПРОДУКЦИЯ 						  */
/*ПОКАЗАТЕЛИ 						   */"Сумма","Кол-во"
/*МВЗ 									*/@RELATIVE({МВЗ},0)
)

FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)	
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*ПРОЧЕЕ 							  */@RELATIVE("Итого по прочим справочникам",0)
/*ЭЛЕМЕНТЫ_ЗАТРАТ					  */
/*МВЗ ПОЛУЧАТЕЛЬ 					  */@RELATIVE("Итого по МВЗ (пол-ль)",0)
)

AGG("ЭЛЕМЕНТЫ_ЗАТРАТ");

ENDFIX


FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)	
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*ПРОЧЕЕ 							  */
/*ЭЛЕМЕНТЫ_ЗАТРАТ					  */"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/*МВЗ ПОЛУЧАТЕЛЬ 					  */@RELATIVE("Итого по МВЗ (пол-ль)",0)
)

AGG("ПРОЧЕЕ");

ENDFIX

FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)	
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*ПРОЧЕЕ 							  */"Прочие справочники ТЧМ И ТЧМС"
/*ЭЛЕМЕНТЫ_ЗАТРАТ					  */"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/*МВЗ ПОЛУЧАТЕЛЬ 					  */	
)

AGG("МВЗ ПОЛУЧАТЕЛЬ");

ENDFIX

FIX(
/*ПРОДУКЦИЯ 						  */	
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*ПРОЧЕЕ 							  */"Прочие справочники ТЧМ И ТЧМС"
/*ЭЛЕМЕНТЫ_ЗАТРАТ					  */"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/*МВЗ ПОЛУЧАТЕЛЬ 					  */"МВЗ получатели"	
)

AGG("ПРОДУКЦИЯ");

ENDFIX

FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0),"ПРОДУКЦИЯ ТЧМ и ТЧМС"	
/*ВИД ЗАТРАТ 						  */
/*ПРОЧЕЕ 							  */"Прочие справочники ТЧМ И ТЧМС"
/*ЭЛЕМЕНТЫ_ЗАТРАТ					  */"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/*МВЗ ПОЛУЧАТЕЛЬ 					  */"МВЗ получатели"	
)

AGG("ВИД_ЗАТРАТ");

ENDFIX
ENDFIX
/*зачищаем целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ЦФО                            */"ПЭО"
/*КОНТРАГЕНТЫ                    */"бу контрагента"
/*НАПРАВЛЕНИЕ                    */"бу направления"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ВАЛЮТА                        */"RUR"
/*ВИД ЗАТРАТ                     */@RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ                        */@RELATIVE("Расходы на производство",0)
/*СЦЕНАРИЙ                        */{СЦЕНАРИЙ}
/*ПЕРИОД                       */@RELATIVE("Всего год",0)
/*ВЕРСИЯ                        */{ВЕРСИЯ}
/*ГОД                            */{ГОД}
/*ПРОДУКЦИЯ                     */@RELATIVE("Всего по продукции",0)
/*ПОКАЗАТЕЛИ                        */"Сумма","Кол-во"
/*МВЗ                           */@RELATIVE({МВЗ},0)
)
CLEARBLOCK ALL;
ENDFIX 


/*переносим  целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */
/*ЦФО                            */"ПЭО"
/*КОНТРАГЕНТЫ                    */"бу контрагента"
/*НАПРАВЛЕНИЕ                        */"бу направления"
/*ПРОЧЕЕ                       */
/*СЧЕТА БАЛАНСА                      */
/*МВЗ ПОЛУЧАТЕЛЬ                 */   
/*ВАЛЮТА                        */"RUR"
/*ВИД ЗАТРАТ                     */
/*СТАТЬИ                        */
/*СЦЕНАРИЙ                        */{СЦЕНАРИЙ}
/*ПЕРИОД                       */@RELATIVE("Всего год",0)
/*ВЕРСИЯ                        */{ВЕРСИЯ}
/*ГОД                            */{ГОД}
/*ПРОДУКЦИЯ                     */@Relative("Всего по продукции", 0)
/*ПОКАЗАТЕЛИ                        */
/*МВЗ                           */
)

FIXPARALLEL(8,@DESCENDANTS("Всего по видам затрат"))
/*Прямые и косвенные
переносятся по цехам 20, 23 в соотвествии с мэпингом формы 0.6.ВЗ прямые или косвенные
*/
FIX(
/*СТАТЬИ                           */
/*МВЗ                           */@REMOVE(@RELATIVE({МВЗ},0),@ILDESCENDANTS(@LIST(
/*управленческие цеха*/
/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП",
/*ремонтные цеха*/
/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ",
/*Соц объекты*/
"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."))
)
)
/*создаем блоки для Прямые производственные расходы*/
FIX(
/*ПОКАЗАТЕЛИ                     */"Кол-во", "Сумма"
)
DATACOPY "Сырье и основные материалы."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты на технологию"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Отходы производства"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Доб.материалы и флюсы"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Оплата труда."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Резерв на отпуск."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое (ТЧМС)"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты по переделу"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Содержание основных фондов"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Амортизация ОС и НМА."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Прочие расходы по цеху"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Огнеупоры."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Внутризаводское перемещение грузов."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Техническое обслуживание."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Малоценные активы"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Сменный инструмент и оборудование"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Товары"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по десульфурации."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по разливке."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "ПОПУТНАЯ ПРОДУКЦИЯ"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Прямые производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";


/*создаем блоки для Прямые производственные расходы*/

DATACOPY "Сырье и основные материалы."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты на технологию"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Отходы производства"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Доб.материалы и флюсы"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Оплата труда."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Резерв на отпуск."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое (ТЧМС)"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты по переделу"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Содержание основных фондов"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Амортизация ОС и НМА."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Прочие расходы по цеху"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Огнеупоры."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Внутризаводское перемещение грузов."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Техническое обслуживание."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Малоценные активы"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Сменный инструмент и оборудование"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Товары"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по десульфурации."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по разливке."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "ПОПУТНАЯ ПРОДУКЦИЯ"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Косвенные производственные расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
ENDFIX

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ПОКАЗАТЕЛИ                     */
/*СТАТЬИ                     */"Прямые производственные расходы"
)
/*удаляем все ВЗ не относящиеся к прямым*/
"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
   IF("ТЧМ в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=1)
   "Сумма"= #missing;
   "Кол-во"= #missing;
    ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ELSE 
   IF("ТЧМС в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=1)
   "Сумма"= #missing;
   "Кол-во"= #missing;
        ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ENDIF
)
CLEARBLOCK EMPTY;
ENDFIX

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ПОКАЗАТЕЛИ                     */
/*СТАТЬИ                     */"Косвенные производственные расходы"
)
/*удаляем все ВЗ не относящиеся к косвенным*/
"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
   IF("ТЧМ в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=2)
   "Сумма"= #missing;
   "Кол-во"= #missing;
    ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ELSE 
   IF("ТЧМС в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=2)
   "Сумма"= #missing;
   "Кол-во"= #missing;
        ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ENDIF
)
CLEARBLOCK EMPTY;
ENDFIX
ENDFIX

/*Расходы на ремонты*/

FIX(
/*СТАТЬИ                           */
/*МВЗ                           */
                              /*ремонтные цеха*/
                              @ILDESCENDANTS(@LIST(/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ")) and @RELATIVE({МВЗ},0)
)
/*создаем блоки для Расходы ремонтных цехов*/
FIX(
/*ПОКАЗАТЕЛИ                     */"Кол-во", "Сумма"
)
DATACOPY "Сырье и основные материалы."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты на технологию"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Отходы производства"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Доб.материалы и флюсы"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Оплата труда."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Резерв на отпуск."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое (ТЧМС)"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты по переделу"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Содержание основных фондов"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Амортизация ОС и НМА."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Прочие расходы по цеху"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Огнеупоры."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Внутризаводское перемещение грузов."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Техническое обслуживание."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Малоценные активы"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Сменный инструмент и оборудование"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Товары"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по десульфурации."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по разливке."->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "ПОПУТНАЯ ПРОДУКЦИЯ"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
ENDFIX

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ПОКАЗАТЕЛИ                     */
/*СТАТЬИ                     */"Расходы ремонтных цехов"
)
/*удаляем все ВЗ не относящиеся к прямым или косвенным*/
"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
   IF("ТЧМ в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"==#missing)
   "Сумма"= #missing;
   "Кол-во"= #missing;
    ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ELSE 
   IF("ТЧМС в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"==#missing)
   "Сумма"= #missing;
   "Кол-во"= #missing;
        ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ENDIF
)
CLEARBLOCK EMPTY;
ENDFIX
ENDFIX 

/*Административно-управленческие расходы*/
FIX(
/*СТАТЬИ                        */
/*МВЗ                           */
                              /*управленческие цеха*/
                              @ILDESCENDANTS(@LIST(/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП")) and @RELATIVE({МВЗ},0)
)
/*создаем блоки для Административно-управленческие расходы*/
FIX(
/*ПОКАЗАТЕЛИ                     */"Кол-во", "Сумма"
)
/*создем блоки*/
DATACOPY "Сырье и основные материалы."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты на технологию"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Отходы производства"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Доб.материалы и флюсы"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Оплата труда."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Резерв на отпуск."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Топливо технологическое (ТЧМС)"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Энергозатраты по переделу"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Содержание основных фондов"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Амортизация ОС и НМА."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Прочие расходы по цеху"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Огнеупоры."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Внутризаводское перемещение грузов."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Техническое обслуживание."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Малоценные активы"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Сменный инструмент и оборудование"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Товары"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по десульфурации."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "Расходы по разливке."->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
DATACOPY "ПОПУТНАЯ ПРОДУКЦИЯ"->"26_Поступление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";





ENDFIX

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ПОКАЗАТЕЛИ                     */
/*СТАТЬИ                     */"Административно-управленческие расходы"
)
/*удаляем все ВЗ не относящиеся к прямым или косвенным*/
"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
   IF("ТЧМ в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"==#missing)
   "Сумма"= #missing;
   "Кол-во"= #missing;
    ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ELSE 
   IF("ТЧМС в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"==#missing)
   "Сумма"= #missing;
   "Кол-во"= #missing;
        ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ENDIF
)

CLEARBLOCK EMPTY;
ENDFIX
ENDFIX 

/*Коммерческие расходы.
переносятся по цехам 20, 23 в соотвествии с мэпингом формы 0.6.ВЗ прямые или косвенные
*/
FIX(
/*СТАТЬИ                           */
/*МВЗ                           */@REMOVE(@RELATIVE({МВЗ},0),@ILDESCENDANTS(@LIST(
                              /*управленческие цеха*/
                              /*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП",
                              /*ремонтные цеха*/
                              /*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ",

                              /*Соц объекты*/
                              "№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."))
)
)
FIX(
/*ПОКАЗАТЕЛИ                     */"Кол-во", "Сумма"
)
/*создаем блоки */
DATACOPY "Коммерческие расходы"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС" to "Коммерческие расходы."->"Калькуляция_Прямых_Косвенных"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
ENDFIX
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ПОКАЗАТЕЛИ                     */
/*СТАТЬИ                     */"Коммерческие расходы."
)
/*удаляем все ВЗ не относящиеся к прямым или косвенным*/
"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
   IF("ТЧМ в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"==#missing)
   "Сумма"= #missing;
   "Кол-во"= #missing;
    ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ELSE 
   IF("ТЧМС в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"==#missing)
   "Сумма"= #missing;
   "Кол-во"= #missing;
        ELSE
    "Сумма"= @SUMRANGE("Сумма"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   "Кол-во"= @SUMRANGE("Кол-во"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",@LIST("Сырье и основные материалы.","Топливо технологическое.","Энергозатраты на технологию","Отходы производства","Доб.материалы и флюсы","Оплата труда.","Резерв на отпуск.","Топливо технологическое (ТЧМС)","Энергозатраты по переделу","Содержание основных фондов","Амортизация ОС и НМА.","Прочие расходы по цеху","Огнеупоры.","Внутризаводское перемещение грузов.","Техническое обслуживание.","Малоценные активы","Сменный инструмент и оборудование","Товары","Расходы по десульфурации.","Расходы по разливке.","ПОПУТНАЯ ПРОДУКЦИЯ"));
   ENDIF
ENDIF
)
CLEARBLOCK EMPTY;
ENDFIX
ENDFIX 


ENDFIXPARALLEL

ENDFIX
/*Агрегируем вспомогательный срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ                    	 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */
/*СТАТЬИ							  */
/*СЦЕНАРИЙ							  */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								  */{ГОД}
/*ПОКАЗАТЕЛИ 						  */"Кол-во", "Сумма"
/*МВЗ 								  */
)
/*Прямые и косвенные
переносятся по цехам 20, 23 в соотвествии с мэпингом формы 0.6.ВЗ прямые или косвенные
*/
FIX(
/*МВЗ 								  */@REMOVE(@RELATIVE({МВЗ},0),@ILDESCENDANTS(@LIST(
										/*управленческие цеха*/
										/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП",
										/*ремонтные цеха*/
										/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ",
										/*Соц объекты*/
										"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."))
										)
/*СТАТЬИ								*/"Прямые производственные расходы","Косвенные производственные расходы"
)

FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)
)
AGG("ВИД_ЗАТРАТ");
ENDFIX

FIX(
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0),"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("ПРОДУКЦИЯ");
ENDFIX

ENDFIX


/*Расходы на ремонты*/
FIX(
/*МВЗ 								   */
										/*ремонтные цеха*/
										@LIST(/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ") and @RELATIVE({МВЗ},0)
/*СТАТЬИ							   */"Расходы ремонтных цехов"
)

FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)
)
AGG("ВИД_ЗАТРАТ");
ENDFIX

FIX(
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0),"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("ПРОДУКЦИЯ");
ENDFIX
ENDFIX 

/*Административно-управленческие расходы*/
FIX(
/*МВЗ 								  */
									   /*управленческие цеха*/
									   @LIST(/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП") and @RELATIVE({МВЗ},0)
/*СТАТЬИ							 	*/"Административно-управленческие расходы"
)
/*удаляем все ВЗ не относящиеся к прямым или косвенным*/

FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)
)
AGG("ВИД_ЗАТРАТ");
ENDFIX

FIX(
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0),"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("ПРОДУКЦИЯ");
ENDFIX
ENDFIX 


ENDFIX
/*зачищаем целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 						 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"НЗП_по_ВЗ"
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ							   */@RELATIVE("Расходы на производство",0)
/*СЦЕНАРИЙ							   */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								   */{ГОД}
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)
/*ПОКАЗАТЕЛИ 						     */"Сумма","Кол-во"
/*МВЗ 								  */@RELATIVE({МВЗ},0)
)
CLEARBLOCK ALL;
ENDFIX 


/*переносим  целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 						 */"бу направления"
/*ПРОЧЕЕ 							 */
/*СЧЕТА БАЛАНСА                      */
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */
/*СТАТЬИ							   */
/*СЦЕНАРИЙ							   */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								   */{ГОД}
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)
/*ПОКАЗАТЕЛИ 						     */
/*МВЗ 								  */
)

FIXPARALLEL(8,@DESCENDANTS("Всего по видам затрат"))
/*Прямые и косвенные
переносятся по цехам 20, 23 в соотвествии с мэпингом формы 0.6.ВЗ прямые или косвенные
*/
FIX(
/*СТАТЬИ 								  */
/*МВЗ 								  */@REMOVE(@RELATIVE({МВЗ},0),@ILDESCENDANTS(@LIST(
										/*управленческие цеха*/
										/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП",
										/*ремонтные цеха*/
										/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ",
										/*Соц объекты*/
										"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."))
)
)
FIX(
/*ПОКАЗАТЕЛИ 						  */Сумма,"Кол-во"
)
/*создаем блоки для Прямые производственные расходы*/

DATACOPY  "бу статьи"->"20_НЗП на конец"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников" to "Прямые производственные расходы"->"НЗП_по_ВЗ"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";


/*создаем блоки для Прямые производственные расходы*/

DATACOPY "бу статьи"->"20_НЗП на конец"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников" to "Косвенные производственные расходы"->"НЗП_по_ВЗ"->"бу МВЗ (пол-ль)"->"бу элемента затрат"->"бу прочих справочников";
ENDFIX

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"НЗП_по_ВЗ"
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ПОКАЗАТЕЛИ 						  */
/*СТАТЬИ							*/"Прямые производственные расходы"
)
/*удаляем все ВЗ не относящиеся к прямым*/
"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
	IF("ТЧМ в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=1)
		"Сумма"=#missing;
		"Кол-во"=#missing;
	ENDIF
ELSE 
	IF("ТЧМС в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=1)
		"Сумма"=#missing;
		"Кол-во"=#missing;
	ENDIF
ENDIF
)
CLEARBLOCK EMPTY;
ENDFIX

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"НЗП_по_ВЗ"
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ПОКАЗАТЕЛИ 						  */
/*СТАТЬИ							*/"Косвенные производственные расходы"
)
/*удаляем все ВЗ не относящиеся к косвенным*/
"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
	IF("ТЧМ в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=2)
		"Сумма"=#missing;
		"Кол-во"=#missing;
	ENDIF
ELSE 
	IF("ТЧМС в целом"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"ВЗ_Прямой_Косвенный"->"бу МВЗ (пол-ль)"->"ССУ"->"бу валюты"->"P0"->"Проект"->"Рабочая 1"->"No Year"!=2)
		"Сумма"=#missing;
		"Кол-во"=#missing;
	ENDIF
ENDIF
)
CLEARBLOCK EMPTY;
ENDFIX
ENDFIX


ENDFIXPARALLEL

ENDFIX
/*зачищаем целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 						 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Среднегодовая_себестоимость"
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ							   */@RELATIVE("Расходы на производство",0)
/*СЦЕНАРИЙ							   */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								   */{ГОД}
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)
/*ПОКАЗАТЕЛИ 						     */"Сумма","Кол-во"
/*МВЗ 								  */@RELATIVE({МВЗ},0)
)
CLEARBLOCK ALL;
ENDFIX 


/*переносим  целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 						 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ							   */
/*СЦЕНАРИЙ							   */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								   */{ГОД}
/*ПРОДУКЦИЯ 						  */
/*ПОКАЗАТЕЛИ 						     */
/*МВЗ 								  */
)
FIXPARALLEL(8,@DESCENDANTS("Всего по продукции"))
FIX(
/*СТАТЬИ							   */"Прямые производственные расходы","Косвенные производственные расходы"
/*МВЗ 								  */@REMOVE(@RELATIVE({МВЗ},0),@ILDESCENDANTS(@LIST(
										/*управленческие цеха*/
										/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП",
										/*ремонтные цеха*/
										/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ",
											/*Соц объекты*/
											"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."))
)
)
FIX(
/*ПОКАЗАТЕЛИ 						  */"Кол-во", "Сумма"
)
DATACOPY "Калькуляция_Прямых_Косвенных"to "Среднегодовая_себестоимость";
DATACOPY "НЗП_по_ВЗ"to "Среднегодовая_себестоимость";

ENDFIX


/*Расчитываем среденегодовую себестоимость по прямым и косвенным с учетом НЗП и остатков ГП*/
FIX(
/*СЧЕТА БАЛАНСА                      */"Среднегодовая_себестоимость"
)

"Сумма"(
IF(@ISDESC("ТЧМ Итого"))
		"Сумма"= ("Сумма"->"Калькуляция_Прямых_Косвенных"
				+ @PRIOR("Сумма"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Сумма"->"НЗП_по_ВЗ")
/*добавляем себестоимость ГП */				
				+"Сумма"->"бу видов затрат"->"ТЧМ в целом"->"Готовая продукция"->"43_Остаток на конец"->"RUR"->"P0"* @ISMBR("январь")
				
				*("Сумма"->"Калькуляция_Прямых_Косвенных" 
				+ @PRIOR("Сумма"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Сумма"->"НЗП_по_ВЗ")
				/
				(@SUMRANGE("Сумма"->"Калькуляция_Прямых_Косвенных",@RELATIVE("Всего по видам затрат",0)) 
				+ @SUMRANGE("Сумма"->"НЗП_по_ВЗ",@RELATIVE("Всего по видам затрат",0)))
				;
		"Кол-во"= "Кол-во"->"Калькуляция_Прямых_Косвенных" 
				+ @PRIOR("Кол-во"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Кол-во"->"НЗП_по_ВЗ"
/*добавляем кол-во ГП */				
				+"Кол-во"->"бу видов затрат"->"ТЧМ в целом"->"Готовая продукция"->"43_Остаток на конец"->"RUR"->"P0"* @ISMBR("январь")

				*("Кол-во"->"Калькуляция_Прямых_Косвенных" 
				+ @PRIOR("Кол-во"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Кол-во"->"НЗП_по_ВЗ")
				/
				(@SUMRANGE("Кол-во"->"Калькуляция_Прямых_Косвенных",@RELATIVE("Всего по видам затрат",0)) 
				+ @SUMRANGE("Кол-во"->"НЗП_по_ВЗ",@RELATIVE("Всего по видам затрат",0)))
				;

ELSE 
		"Сумма"= ("Сумма"->"Калькуляция_Прямых_Косвенных"
				+ @PRIOR("Сумма"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Сумма"->"НЗП_по_ВЗ")
/*добавляем себестоимость ГП */				
				+"Сумма"->"бу видов затрат"->"ТЧМ в целом"->"Готовая продукция"->"43_Остаток на конец"->"RUR"->"P0"* @ISMBR("январь")
				
				*("Сумма"->"Калькуляция_Прямых_Косвенных" 
				+ @PRIOR("Сумма"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Сумма"->"НЗП_по_ВЗ")
				/
				(@SUMRANGE("Сумма"->"Калькуляция_Прямых_Косвенных",@RELATIVE("Всего по видам затрат",0)) 
				+ @SUMRANGE("Сумма"->"НЗП_по_ВЗ",@RELATIVE("Всего по видам затрат",0)))
				;
		"Кол-во"= "Кол-во"->"Калькуляция_Прямых_Косвенных" 
				+ @PRIOR("Кол-во"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Кол-во"->"НЗП_по_ВЗ"
/*добавляем кол-во ГП */				
				+"Кол-во"->"бу видов затрат"->"ТЧМС в целом"->"Готовая продукция"->"43_Остаток на конец"->"RUR"->"P0"* @ISMBR("январь")

				*("Кол-во"->"Калькуляция_Прямых_Косвенных" 
				+ @PRIOR("Кол-во"->"НЗП_по_ВЗ",1,@LIST("P0","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"))
				-"Кол-во"->"НЗП_по_ВЗ")
				/
				(@SUMRANGE("Кол-во"->"Калькуляция_Прямых_Косвенных",@RELATIVE("Всего по видам затрат",0)) 
				+ @SUMRANGE("Кол-во"->"НЗП_по_ВЗ",@RELATIVE("Всего по видам затрат",0)))
				;
ENDIF
)
CLEARBLOCK EMPTY;
ENDFIX
ENDFIX

FIX(
/*СТАТЬИ							   */"Коммерческие расходы."
/*МВЗ 								  */@REMOVE(@RELATIVE({МВЗ},0),@ILDESCENDANTS(@LIST(
										/*управленческие цеха*/
										/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП",
										/*ремонтные цеха*/
										/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ",
										/*Соц объекты*/
										"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."))
										)
)
FIX(
/*ПОКАЗАТЕЛИ 						  */"Кол-во", "Сумма"
)
DATACOPY "Калькуляция_Прямых_Косвенных"to "Среднегодовая_себестоимость";
ENDFIX


/*Расчитываем среденегодовую себестоимость по прямым и косвенным с учетом НЗП и остатков ГП*/
FIX(
/*СЧЕТА БАЛАНСА                      */"Среднегодовая_себестоимость"
)
"Сумма"(
		"Сумма"= "Сумма"->"Калькуляция_Прямых_Косвенных";
		"Кол-во"= "Кол-во"->"Калькуляция_Прямых_Косвенных";
)		
ENDFIX
ENDFIX 
FIX(
/*МВЗ 								  */@RELATIVE({МВЗ},0)
)


/*Расчитываем среденегодовую себестоимость по прямым и косвенным с учетом НЗП и остатков ГП*/
FIX(
/*ПОКАЗАТЕЛИ						 */"Сумма"
/*СЧЕТА БАЛАНСА                      */"Расходы ремонтных цехов"
)

"Среднегодовая_себестоимость"= @ALLOCATE("Калькуляция_Прямых_Косвенных"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"Расходы ремонтных цехов",@ILDESCENDANTS(@LIST("№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ")),"Текущие ремонты"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС",,share);
	
ENDFIX
ENDFIX


ENDFIXPARALLEL
ENDFIX
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 						 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */
/*СТАТЬИ							   */
/*СЦЕНАРИЙ							   */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								   */{ГОД}
/*ПРОДУКЦИЯ 						  */"ПРОДУКЦИЯ ТЧМ и ТЧМС"
/*ПОКАЗАТЕЛИ 						     */
/*МВЗ 								  */
)

FIX(
/*МВЗ 								  */@RELATIVE({МВЗ},0)
)


/*Перекладываем Расходы ремонтных цехов на продукты */
FIX(
/*ПОКАЗАТЕЛИ						 */"Сумма"
/*СЧЕТА БАЛАНСА                      */"Расходы ремонтных цехов"
)

FIXPARALLEL(8, @DESCENDANTS("Всего по видам затрат"))
"Среднегодовая_себестоимость"(
IF("Расходы ремонтных цехов"->"Калькуляция_Прямых_Косвенных"!=#missing)
"Среднегодовая_себестоимость" = @ALLOCATE("Сумма"->"Калькуляция_Прямых_Косвенных",@DESCENDANTS("Всего по продукции"),"Текущие ремонты"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->{МВЗ},,share);
ENDIF
)

ENDFIXPARALLEL
ENDFIX

/*Перекладываем Административно-управленческие расходы на продукты */
FIX(
/*ПОКАЗАТЕЛИ						 */"Сумма"
/*СЧЕТА БАЛАНСА                      */"Административно-управленческие расходы"
)

FIXPARALLEL(8, @DESCENDANTS("Всего по видам затрат"))

"Среднегодовая_себестоимость"(
IF("Административно-управленческие расходы"->"Калькуляция_Прямых_Косвенных"!=#missing)
"Среднегодовая_себестоимость" = @ALLOCATE("Сумма"->"Калькуляция_Прямых_Косвенных",@DESCENDANTS("Всего по продукции"),"УПРАВЛЕНЧЕСКИЕ РАСХОДЫ"->"20_Начисление"->"МВЗ получатели"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Прочие справочники ТЧМ И ТЧМС"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->{МВЗ},,share);
ENDIF
)

ENDFIXPARALLEL

ENDFIX
ENDFIX


ENDFIX
/*зачищаем агрегат сметы */

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 	 					 */"бу направления"
/*ПРОЧЕЕ 							 */
/*СЧЕТА БАЛАНСА                      */@RELATIVE("Начисление",0)
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */
/*СТАТЬИ							  */@RELATIVE("ПОЛНАЯ СЕБЕСТОИМОСТЬ",0)
/*СЦЕНАРИЙ							  */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Итого год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								  */{ГОД}
/*ПРОДУКЦИЯ 						  */
/*ПОКАЗАТЕЛИ 						   */"Сумма","Кол-во"
/*МВЗ 									*/
)


FIX(
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0),"ПРОДУКЦИЯ ТЧМ и ТЧМС"	
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0),"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
/*ПРОЧЕЕ 							  */"Прочие справочники ТЧМ И ТЧМС",@RELATIVE("Итого по прочим справочникам",0)
/*ЭЛЕМЕНТЫ_ЗАТРАТ					  */"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/*МВЗ ПОЛУЧАТЕЛЬ 					  */@RELATIVE("Итого по МВЗ (пол-ль)",0),"МВЗ получатели"
)
FIXPARALLEL(8,@DESCENDANTS({МВЗ}))
CLEARBLOCK ALL;
ENDFIXPARALLEL
ENDFIX
ENDFIX
FIX(
/*МВЗ  									*/@LIST("ТЧМ в целом", "ТЧМС в целом") and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОЧЕЕ 								*/
/*ПРОДУКЦИЯ  							*/
/*НАПРАВЛЕНИЕ  		*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/@Relative("Всего по усл. поставки",0),"бу элемента затрат"
/*МВЗ ПОЛУЧАТЕЛЬ  						*/"бу МВЗ (пол-ль)"
/*ВАЛЮТА  								*/ "USD", "EUR","Рубль (расчет)","RUR"
/*ПЕРИОД  								*/@RELATIVE("Всего год",0)
/*КОНТРАГЕНТЫ  							*/
/*ВЕРСИЯ	  							*/{ВЕРСИЯ}
/*ГОД  									*/{ГОД}
/*МВЗ  									*/
/*СЦЕНАРИЙ  							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ 							*/
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*СТАТЬИ  								*/@RELATIVE("Поступления от реализации",0)
/*ПОКАЗАТЕЛИ  							*/"Кол-во","Сумма"
/*СЧЕТА БАЛАНСА  						*/"62_Реализация без НДС"
)
FIXPARALLEL(8,@DESCENDANTS("Всего по продукции"))
FIX(
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам",0)
/*ПРОЧЕЕ 								*/@Relative ("Всего по типам договоров",0),"бу прочих справочников"
/*ВИД ЗАТРАТ 							*/@Relative("Всего по складам",0),"бу видов затрат"
)
AGG("НАПРАВЛЕНИЕ");
ENDFIX 
FIX(
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам",0)
/*НАПРАВЛЕНИЕ  							*/"Направления","Внутр рынок (ЖД)",@RELATIVE("ЖД отгрузка",0)
/*ПРОЧЕЕ 								*/
/*ВИД ЗАТРАТ 							*/@Relative("Всего по складам",0),"бу видов затрат"
)
AGG("ПРОЧЕЕ");
ENDFIX 

FIX(
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам",0)
/*НАПРАВЛЕНИЕ  							*/"Направления","Внутр рынок (ЖД)",@RELATIVE("ЖД отгрузка",0)
/*ПРОЧЕЕ 								*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/
)
AGG("ВИД_ЗАТРАТ");
ENDFIX 
FIX(
/* КОНТРАГЕНТЫ							*/
/*НАПРАВЛЕНИЕ  							*/"Направления","Внутр рынок (ЖД)",@RELATIVE("ЖД отгрузка",0)
/*ПРОЧЕЕ 								*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("КОНТРАГЕНТЫ");
ENDFIX 
ENDFIXPARALLEL
ENDFIX 
ENDFIX
/*зачищаем целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 						 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Списание_себестоимости"
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ							   */@RELATIVE("Расходы на производство",0)
/*СЦЕНАРИЙ							   */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								   */{ГОД}
/*ПРОДУКЦИЯ 						  */@RELATIVE("Всего по продукции",0)
/*ПОКАЗАТЕЛИ 						     */"Сумма","Кол-во"
/*МВЗ 								  */@RELATIVE({МВЗ},0)
)
CLEARBLOCK ALL;
ENDFIX 


/*переносим  целевой срез*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ 						 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ							   */@RELATIVE("Расходы на производство",0)
/*СЦЕНАРИЙ							   */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							   */{ВЕРСИЯ}
/*ГОД 								   */{ГОД}
/*ПРОДУКЦИЯ 						   */
/*ПОКАЗАТЕЛИ 						   */
/*МВЗ 								   */@RELATIVE({МВЗ},0)
)

FIXPARALLEL(8,@DESCENDANTS("Всего по продукции"))

FIX(
/*ПОКАЗАТЕЛИ 						   */"Кол-во","Сумма"
)
/*Создаем блоки*/
DATACOPY "Среднегодовая_себестоимость" to "Списание_себестоимости";

ENDFIX

FIX(
/*СЧЕТА БАЛАНСА                      */"Списание_себестоимости"
)
/*Колличество берем из продаж*/
"Кол-во"(
IF( @ISDESC("ТЧМ Итого"))
	IF(
	/*Объем реализации основной продукции*/
	"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"
	/*Объем реализации на внутр-й рынок*/
	+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
	/*Объем реализации прочей продукции*/
	+"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"бу элемента затрат"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
	>0)
	/*расчитываем пропорцию списания*/
"Кол-во"=	"Кол-во"*
			(/*Объем реализации основной продукции*/
			"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"
			/*Объем реализации на внутр-й рынок*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			/*Объем реализации прочей продукции*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"бу элемента затрат"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			)
			/"бу видов затрат"->"ПЭО"->"Кол-во с учетом годного выхода."->"20_Начисление"->"Кол-во"->"RUR"
			;
"Сумма"=	"Сумма"*
			(/*Объем реализации основной продукции*/
			"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"
			/*Объем реализации на внутр-й рынок*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			/*Объем реализации прочей продукции*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"бу элемента затрат"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			)
			/"бу видов затрат"->"ПЭО"->"Кол-во с учетом годного выхода."->"20_Начисление"->"Кол-во"->"RUR"
			;			
	ENDIF
ELSE 
	IF(
	/*Объем реализации основной продукции*/
	"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"
	/*Объем реализации на внутр-й рынок*/
	+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
	/*Объем реализации прочей продукции*/
	+"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"бу элемента затрат"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
	>0)
"Кол-во"=	"Кол-во"*
			(/*Объем реализации основной продукции*/
			"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"
			/*Объем реализации на внутр-й рынок*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			/*Объем реализации прочей продукции*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"бу элемента затрат"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			)
			/"бу видов затрат"->"ПЭО"->"Кол-во с учетом годного выхода."->"20_Начисление"->"Кол-во"->"RUR"
			;
"Сумма"=	"Сумма"*
			(/*Объем реализации основной продукции*/
			"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"
			/*Объем реализации на внутр-й рынок*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"Всего по усл. поставки"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			/*Объем реализации прочей продукции*/
			+ "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМС в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Упр по реал-ции прод-ции"->"бу элемента затрат"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR"
			)
			/"бу видов затрат"->"ПЭО"->"Кол-во с учетом годного выхода."->"20_Начисление"->"Кол-во"->"RUR"
			;	
	ENDIF 
ENDIF
)
ENDFIX

ENDFIXPARALLEL

ENDFIX
/*Удаляем агрегаты вспомогательного среза*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ					 */"бу элемента затрат"
/*ЦФО 						  		 */"ПЭО"
/*КОНТРАГЕНТЫ 						 */"бу контрагента"
/*НАПРАВЛЕНИЕ                    	 */"бу направления"
/*ПРОЧЕЕ 							 */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Калькуляция_Прямых_Косвенных"
/*МВЗ ПОЛУЧАТЕЛЬ 					 */	"бу МВЗ (пол-ль)"
/*ВАЛЮТА 							  */"RUR"
/*ВИД ЗАТРАТ 						  */
/*СТАТЬИ							  */
/*СЦЕНАРИЙ							  */{СЦЕНАРИЙ}
/*ПЕРИОД							  */@RELATIVE("Всего год",0)
/*ВЕРСИЯ 							  */{ВЕРСИЯ}
/*ГОД 								  */{ГОД}
/*ПОКАЗАТЕЛИ 						  */"Кол-во", "Сумма"
/*МВЗ 								  */
)
/*Прямые и косвенные
переносятся по цехам 20, 23 в соотвествии с мэпингом формы 0.6.ВЗ прямые или косвенные
*/
FIX(
/*МВЗ 								  */@REMOVE(@RELATIVE({МВЗ},0),@ILDESCENDANTS(@LIST(
										/*управленческие цеха*/
										/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП",
										/*ремонтные цеха*/
										/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ",
										/*Соц объекты*/
										"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."))
										)
/*СТАТЬИ								*/"Прямые производственные расходы","Косвенные производственные расходы"
)



FIX(
/*ПРОДУКЦИЯ 						  */"ПРОДУКЦИЯ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0),"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
CLEARBLOCK ALL;
ENDFIX

ENDFIX


/*Расходы на ремонты*/
FIX(
/*МВЗ 								   */
										/*ремонтные цеха*/
										@LIST(/*тчмс*/"Ремонтный цех",/*тчм*/"№15. ЦРМО", "№10. ТЭРЦ", "№8. ЦКРО", "№21. РМЦ") and @RELATIVE({МВЗ},0)
/*СТАТЬИ							   */"Расходы ремонтных цехов"
)

FIX(
/*ПРОДУКЦИЯ 						  */"ПРОДУКЦИЯ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0),"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
CLEARBLOCK ALL;
ENDFIX
ENDFIX 

/*Административно-управленческие расходы*/
FIX(
/*МВЗ 								  */
									   /*управленческие цеха*/
									   @LIST(/*тчмс*/"управление","лаборатория",/*тчм*/"№9. Цех связи","№11. АСС","№13. ЦЛХТиТК","№20. Управление","№22. ИТЦ","№23. Цех питания","№25. ЦЛА","№26. Хоз цех","№29. ЦОП") and @RELATIVE({МВЗ},0)
/*СТАТЬИ							 	*/"Административно-управленческие расходы"
)
/*удаляем все ВЗ не относящиеся к прямым или косвенным*/

FIX(
/*ПРОДУКЦИЯ 						  */"ПРОДУКЦИЯ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 						  */@RELATIVE("Всего по видам затрат",0),"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
CLEARBLOCK ALL;
ENDFIX
ENDFIX 


ENDFIX
FIX(
/*МВЗ  									*/@LIST("ТЧМ в целом", "ТЧМС в целом") and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОЧЕЕ 								*/
/*ПРОДУКЦИЯ  							*/
/*НАПРАВЛЕНИЕ  		*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/@Relative("Всего по усл. поставки",0),"бу элемента затрат"
/*МВЗ ПОЛУЧАТЕЛЬ  						*/"бу МВЗ (пол-ль)"
/*ВАЛЮТА  								*/ "USD", "EUR","Рубль (расчет)","RUR"
/*ПЕРИОД  								*/@RELATIVE("Всего год",0)
/*КОНТРАГЕНТЫ  							*/
/*ВЕРСИЯ	  							*/{ВЕРСИЯ}
/*ГОД  									*/{ГОД}
/*МВЗ  									*/
/*СЦЕНАРИЙ  							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ 							*/
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*СТАТЬИ  								*/@RELATIVE("Поступления от реализации",0)
/*ПОКАЗАТЕЛИ  							*/"Кол-во","Сумма"
/*СЧЕТА БАЛАНСА  						*/"62_Реализация без НДС"
)

FIXPARALLEL(8,@DESCENDANTS("Всего по продукции"))
FIX(
/*НАПРАВЛЕНИЕ  							*/"Направления"
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам",0),"Контрагенты ТЧМ и ТЧМС"
/*ПРОЧЕЕ 								*/@Relative ("Всего по типам договоров",0),"бу прочих справочников","ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/@Relative("Всего по складам",0),"бу видов затрат","ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
CLEARBLOCK ALL;
ENDFIX 

FIX(
/*НАПРАВЛЕНИЕ  							*/"Внутр рынок (ЖД)",@RELATIVE("ЖД отгрузка",0)
/*КОНТРАГЕНТЫ  							*/"Контрагенты ТЧМ и ТЧМС"
/*ПРОЧЕЕ 								*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
CLEARBLOCK ALL;
ENDFIX 

ENDFIXPARALLEL

ENDFIX 

ENDFIX
FIX(
/*МВЗ 								*/@LIST("ТЧМС в целом", "ТЧМ в целом") AND @RELATIVE({МВЗ},0)
)

FIX(
/*НАПРАВЛЕНИЕ 	*/
/*МВЗ ПОЛУЧАТЕЛЬ 					*/"бу МВЗ (пол-ль)"
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/
/*МВЗ 								*/
/*СЦЕНАРИЙ 							*/{СЦЕНАРИЙ}
/*ГОД 								*/{ГОД}
/*ВАЛЮТА 							*/@RELATIVE("Валюты ввода",0)
/*ВЕРСИЯ 							*/{ВЕРСИЯ}
/*ЦФО 								*/
/*СЧЕТА БАЛАНСА 					*/
/*ПРОЧЕЕ 							*/
/*КОНТРАГЕНТЫ 						*/
/*ВИД ЗАТРАТ 						*/
/*СТАТЬИ 							*/
/*ПРОДУКЦИЯ 						*/
/*ПОКАЗАТЕЛИ 						*/"Сумма"
/*ПЕРИОД 							*/@RELATIVE("Итого год",0)
)
SET CREATENONMISSINGBLK ON;
/*Переносим Кредиты и Займы*/
FIX(
/*ПРОЧЕЕ 							*/"бу прочих справочников"
/*НАПРАВЛЕНИЕ 						*/"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/"бу элемента затрат"
/*ЦФО 								*/@RELATIVE("Итого по ЦФО",0)
/*КОНТРАГЕНТЫ 						*/
/*МВЗ 								*/
/*ПРОДУКЦИЯ 						*/"бу вида продукции"
/*ВИД ЗАТРАТ 						*/"бу видов затрат"
/*СТАТЬИ 							*/
/*СЧЕТА БАЛАНСА 					*/"Сумма без НДС."
)

FIX(
/*КОНТРАГЕНТЫ 						*/@RELATIVE("БАНКИ",0)
)
"Проценты по банковским кредитам"(

"Проценты по банковским кредитам"="бу видов затрат"->"Всего по срочности"->"Всего по обязательствам"->"бу элемента затрат"->"бу статьи"->"66_Начисление %";
)
CLEARBLOCK EMPTY;
ENDFIX

FIX(
/*КОНТРАГЕНТЫ 						*/@RELATIVE("Внутригрупповые",0)
)

"Проценты по займам к уплате"(

"% по займам полученным в расходы периода"="бу видов затрат"->"Всего по срочности"->"Всего по обязательствам"->"бу элемента затрат"->"бу статьи"->"66_Начисление %";
)
CLEARBLOCK EMPTY;
ENDFIX

ENDFIX

/*Переносим Займы выданные*/
FIX(
/*ПРОЧЕЕ 							*/"бу прочих справочников"
/*НАПРАВЛЕНИЕ 	*/"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/"бу элемента затрат"
/*ЦФО 								*/@RELATIVE("Итого по ЦФО",0)
/*КОНТРАГЕНТЫ 						*/"Прочие внешние",@RELATIVE("Внутригрупповые",0)
/*МВЗ 								*/
/*ПРОДУКЦИЯ 						*/"бу вида продукции"
/*ВИД ЗАТРАТ 						*/"бу видов затрат"
/*СТАТЬИ 							*/
/*СЧЕТА БАЛАНСА 					*/"Сумма без НДС."
)

"Проценты по займам"(
"% по займам выданным"="бу видов затрат"->"Всего по срочности"->"Займы выданные."->"бу элемента затрат"->"бу статьи"->"58_Начисление процентов";
)

CLEARBLOCK EMPTY;

ENDFIX
SET CREATENONMISSINGBLK OFF;
ENDFIX 
ENDFIX
FIX(
/*МВЗ 								*/@RELATIVE({МВЗ},0)
)
FIX(
/*НАПРАВЛЕНИЕ 	*/
/*МВЗ ПОЛУЧАТЕЛЬ 					*/"бу МВЗ (пол-ль)"
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/
/*МВЗ 								*/
/*СЦЕНАРИЙ 							*/{СЦЕНАРИЙ}
/*ГОД 								*/{ГОД}
/*ВАЛЮТА 							*/
/*ВЕРСИЯ 							*/{ВЕРСИЯ}
/*ЦФО 								*/
/*СЧЕТА БАЛАНСА 					*/
/*ПРОЧЕЕ 							*/
/*КОНТРАГЕНТЫ 						*/
/*ВИД ЗАТРАТ 						*/
/*СТАТЬИ 							*/
/*ПРОДУКЦИЯ 						*/
/*ПОКАЗАТЕЛИ 						*/
/*ПЕРИОД 							*/@RELATIVE("Итого год",0)
)
/*Переносим фин вложения*/
FIX(
/*ПРОЧЕЕ 							*/@RELATIVE("Итого по прочим справочникам",0)
/*НАПРАВЛЕНИЕ 						*/@RELATIVE("Итого по направлениям",0)
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/@RELATIVE("Итого по элементам затрат",0)
/*ЦФО 								*/@RELATIVE("Итого по ЦФО",0)
/*КОНТРАГЕНТЫ 						*/@RELATIVE("Итого по контрагентам",0)
/*МВЗ 								*/
/*ПРОДУКЦИЯ 						*//*"бу вида продукции"*/@Relative("Итого по продукции", 0)
/*ВИД ЗАТРАТ 						*//*"бу видов затрат"*/@Relative("Итого по видам затрат", 0)
/*СТАТЬИ 							*/
/*СЧЕТА БАЛАНСА 					*/@Children("Сумма без НДС"),@Children("Движения БДР")
)

FIX (
/*ПОКАЗАТЕЛИ 						*/"Сумма","Кол-во"
/*ВАЛЮТА 					   		*/ "Рубль (расчет)"
)
FIXPARALLEL(8, @DESCENDANTS("БДР"))
CLEARBLOCK ALL;
ENDFIXPARALLEL
ENDFIX
FIX (
/*ПОКАЗАТЕЛИ 						*/"Сумма","Кол-во"
)
FIXPARALLEL(8,@DESCENDANTS("БДР"))
DATACOPY RUR TO "Рубль (расчет)";
DATACOPY USD TO "Рубль (расчет)";
DATACOPY EUR TO "Рубль (расчет)";
ENDFIXPARALLEL
ENDFIX

FIX (
/*ВАЛЮТА 						*/ "Рубль (расчет)"
)
FIXPARALLEL(8,@DESCENDANTS("БДР"))

"Сумма"(
		"RUR"->"Сумма"
		+"USD"->"Сумма"*"USD"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)"
		+"EUR"->"Сумма"*"EUR"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)";
)

"Кол-во"(
		"RUR"->"Кол-во"
		+"USD"->"Кол-во"
		+"EUR"->"Кол-во";
)

ENDFIXPARALLEL
ENDFIX

ENDFIX
ENDFIX
ENDFIX
FIX(
/*МВЗ 								*/@RELATIVE({МВЗ},0)
)
FIX(
/*НАПРАВЛЕНИЕ 	*/
/*МВЗ ПОЛУЧАТЕЛЬ 					*/"бу МВЗ (пол-ль)"
/*СТАТЬИ 							*/@RELATIVE("БДР",0)
/*МВЗ 								*/
/*СЦЕНАРИЙ 							*/{СЦЕНАРИЙ}
/*ГОД 								*/{ГОД}
/*ВЕРСИЯ 							*/{ВЕРСИЯ}
/*ПЕРИОД 							*/@RELATIVE("Итого год",0)
/*ПРОДУКЦИЯ 						*//*"бу вида продукции"*/@Relative("Итого по продукции", 0)
/*ВИД ЗАТРАТ 						*//*"бу видов затрат"*/@Relative("Итого по видам затрат", 0)
/*СЧЕТА БАЛАНСА 					*/@Children("Сумма без НДС"),@Children("Движения БДР")
/*ПОКАЗАТЕЛИ 						*/"Сумма","Кол-во"
/*ВАЛЮТА 					   		*/ "Рубль (расчет)","RUR","USD","EUR"
)
FIX(
/*ПРОЧЕЕ 							*/
/*НАПРАВЛЕНИЕ 						*/@RELATIVE("Итого по направлениям",0)
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/@RELATIVE("Итого по элементам затрат",0)
/*ЦФО 								*/@RELATIVE("Итого по ЦФО",0)
/*КОНТРАГЕНТЫ 						*/@RELATIVE("Итого по контрагентам",0)
)

AGG(ПРОЧЕЕ);

ENDFIX

FIX(
/*ПРОЧЕЕ 							*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ И ТЧМС"
/*НАПРАВЛЕНИЕ 						*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/@RELATIVE("Итого по элементам затрат",0)
/*ЦФО 								*/@RELATIVE("Итого по ЦФО",0)
/*КОНТРАГЕНТЫ 						*/@RELATIVE("Итого по контрагентам",0)
)

AGG(НАПРАВЛЕНИЕ);

ENDFIX

FIX(
/*ПРОЧЕЕ 							*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ И ТЧМС"
/*НАПРАВЛЕНИЕ 						*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/@RELATIVE("Итого по элементам затрат",0)
/*ЦФО 								*/@RELATIVE("Итого по ЦФО",0)
/*КОНТРАГЕНТЫ 						*/@RELATIVE("Итого по контрагентам",0)
)

AGG(НАПРАВЛЕНИЕ);

ENDFIX

FIX(
/*ПРОЧЕЕ 							*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ И ТЧМС"
/*НАПРАВЛЕНИЕ 						*/"Направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/
/*ЦФО 								*/@RELATIVE("Итого по ЦФО",0)
/*КОНТРАГЕНТЫ 						*/@RELATIVE("Итого по контрагентам",0)
)

AGG("ЭЛЕМЕНТЫ_ЗАТРАТ");

ENDFIX

FIX(
/*ПРОЧЕЕ 							*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ И ТЧМС"
/*НАПРАВЛЕНИЕ 						*/"Направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/*ЦФО 								*/
/*КОНТРАГЕНТЫ 						*/@RELATIVE("Итого по контрагентам",0)
)

AGG(ЦФО);

ENDFIX

FIX(
/*ПРОЧЕЕ 							*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ И ТЧМС"
/*НАПРАВЛЕНИЕ 						*/"Направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ 					*/"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/*ЦФО 								*/"Центры финансовой ответсвенности"
/*КОНТРАГЕНТЫ 						*/
)

AGG(КОНТРАГЕНТЫ);

ENDFIX

ENDFIX
ENDFIX]]></script>
    </rule>
  </rules>
  <components></components>
</HBRRepo>