<?xml version="1.0" encoding="UTF-8"?>
<HBRRepo>
  <variables>
    <variable id="1" name="СПИСОК_ПЕРИОД" product="Planning" type="members" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">ПЕРИОД</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите 1 или несколько месяцев</property>
      <property name="scope">ruleset</property>
      <property name="useLastValue">true</property>
      <value>"Всего год"</value>
    </variable>
    <variable id="2" name="ГОД" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Year</property>
      <property name="prompt_text">Выберите Год</property>
      <property name="scope">ruleset</property>
      <value>FY18</value>
    </variable>
    <variable id="3" name="ВЕРСИЯ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Version</property>
      <property name="prompt_text">Выберите Версию</property>
      <property name="scope">ruleset</property>
      <value>Рабочая_1</value>
    </variable>
    <variable id="4" name="СЦЕНАРИЙ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Scenario</property>
      <property name="prompt_text">Выберите Сценарий</property>
      <property name="scope">ruleset</property>
      <value>Проект</value>
    </variable>
    <variable id="5" name="МВЗ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">МВЗ</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите МВЗ</property>
      <property name="scope">ruleset</property>
      <value>"Итого по МВЗ"</value>
    </variable>
  </variables>
  <rulesets></rulesets>
  <rules>
    <rule id="1" name="0.0.х.Перераспределяем на ЭЗ ВЗ из 6.15" product="Planning">
      <property name="application">ТЧМ</property>
      <property name="plantype">Plan1</property>
      <property name="display_label">0.0.х.Перераспределяем на ЭЗ ВЗ из 6.15</property>
      <variable_references>
        <variable_reference id="3" name="ВЕРСИЯ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">0.0.х.Перераспределяем на ЭЗ ВЗ из 6.15</property>
          <property name="seq">1</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="4" name="СЦЕНАРИЙ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">0.0.х.Перераспределяем на ЭЗ ВЗ из 6.15</property>
          <property name="seq">2</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="2" name="ГОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">0.0.х.Перераспределяем на ЭЗ ВЗ из 6.15</property>
          <property name="seq">3</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="5" name="МВЗ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">0.0.х.Перераспределяем на ЭЗ ВЗ из 6.15</property>
          <property name="seq">4</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="1" name="СПИСОК_ПЕРИОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">0.0.х.Перераспределяем на ЭЗ ВЗ из 6.15</property>
          <property name="seq">5</property>
          <property name="type">4</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
      </variable_references>
      <script><![CDATA[SET AGGMISSG ON;
SET UPDATECALC OFF;
SET CREATEBLOCKONEQ OFF;
SET CREATENONMISSINGBLK OFF;
SET FRMLBOTTOMUP OFF;
SET REMOTECALC OFF;
SET CALCPARALLEL 1;
SET CALCTASKDIMS 1;
SET EMPTYMEMBERSETS ON;
SET FRMLRTDYNAMIC OFF;
SET MSG INFO;
/* Проверка корректности рассчитываемого среза данных */

FIX(
/* ВАЛЮТА							*/	"бу валюты"
/* ПЕРИОД							*/	"P0"
/* ГОД								*/	"No Year"
/* ВЕРСИЯ							*/	
/* СЦЕНАРИЙ							*/	
/* ЦФО								*/	"бу ЦФО"
/* МВЗ								*/	"бу МВЗ"
/* МВЗ ПОЛУЧАТЕЛЬ					*/	"бу МВЗ (пол-ль)"
/* СЧЕТА БАЛАНСА					*/	"80_Увеличение"
/* СТАТЬИ							*/	
/* ПОКАЗАТЕЛИ						*/	"Сумма"
/* ВИД ЗАТРАТ						*/	"бу видов затрат"
/* ПРОДУКЦИЯ						*/	"бу вида продукции"
/* КОНТРАГЕНТЫ						*/	"бу контрагента"
/* НАПРАВЛЕНИЕ	*/	"бу направления"
/* ЭЛЕМЕНТЫ_ЗАТРАТ					*/	"бу элемента затрат"
/* ПРОЧЕЕ							*/	"бу прочих справочников"

)
  SET CREATENONMISSINGBLK ON;

  
  var ErrFlagScenario=0;
  var ErrFlagVersion=0;
  var NextM=2;
  /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА СЦЕНАРИЯ */
  FIX(/* Сценарий */ {СЦЕНАРИЙ} AND @LIST(&ОТКРЫТЫЕ_СЦЕНАРИИ))
    FIX(
    /* Сценарий */ 
    /* Версия   */ "Рабочая 1"
    )
     "бу статьи" (
     IF (ErrFlagScenario==0)
            ErrFlagScenario=1;
     ENDIF
     );

    ENDFIX
  ENDFIX

   /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА ВЕРСИИ */
  FIX(/* Версия  */ {ВЕРСИЯ} AND @LIST(&ОТКРЫТЫЕ_ВЕРСИИ))
    FIX(
    /* Сценарий */ "Проект"
    /* Версия   */ 
    )
     "бу статьи" (
     IF (ErrFlagVersion==0)
            ErrFlagVersion=1;
     ENDIF
     );
    ENDFIX
  ENDFIX

  /* ВЫВОД СООБЩЕНИЙ О НЕКОРРЕКТНОМ СРЕЗЕ */
  FIX(
  /* Сценарий     */ "Проект"
  /* Версия       */ "Рабочая 1"
  )

   "бу статьи" (
    IF (ErrFlagScenario==0)
       @RETURN("Выбран сценарий, закрытый для расчета. Расчет не произведен.",ERROR);
    ENDIF
    IF (ErrFlagVersion==0)
       @RETURN("Выбрана версия, закрытая для расчета. Расчет не произведен.",ERROR);
    ENDIF
    )

   ENDFIX
ENDFIX
SET CREATENONMISSINGBLK OFF;
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ               */
/*ЦФО                           */"ПЭО"
/*ВАЛЮТА                        */"RUR"
/*МВЗ ПОЛУЧАТЕЛЬ                */"бу МВЗ (пол-ль)"
/*КОНТРАГЕНТЫ                   */"бу контрагента"
/*НАПРАВЛЕНИЕ                   */"бу направления"
/*ПРОЧЕЕ                        */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                 */"20_Начисление"
/*ГОД                           */{ГОД}
/*ВЕРСИЯ                        */{ВЕРСИЯ}
/*МВЗ                           */
/*ПЕРИОД                        */@ILDESCENDANTS({СПИСОК_ПЕРИОД}) and @RELATIVE("Всего год",0)
/*СЦЕНАРИЙ                      */{СЦЕНАРИЙ}
/*СТАТЬИ                        */@Relative("ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ", 0)
/*ВИД ЗАТРАТ                     */

)


/*переносим ВЗ на элементы затрат из 6.15*/

/*Доменные печи*/
FIX(
/*МВЗ                           */@RELATIVE("Доменные печи",0) and @RELATIVE({МВЗ},0)
)
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                  */
/*ПРОДУКЦИЯ                        */@RELATIVE("Чугун",0)
/*ВИД ЗАТРАТ                     	*/"Отсев агломерата","Окатыши МГОК",
                                    "Окатыши ЛГОК",
                                    "Окатыши Карельские",
                                    "Руда марганцевая",
                                    "Руда доменная МГОК",
                                    "Руда доменная КЖРК",
                                    "Железорудное сырье (ДЦ)",
                                    "Скрап переработанный",
                                    "МК-50","МК-80","МК-250","Доломит.",
                                    "Известняк фр. 40-70",
                                    "Кокс влажный металлургический",
                                    "Коксовая мелочь с печей",
                                    "Коксовая мелочь с РВО",
                                    "Коксовый орех +25",
                                    "Коксовый орех с РВО",
                                    "Кокс после рассева по бу"
)
FIX(
/*Показатели						*/"Сумма"
/*ЭЛЕМЕНТЫ_ЗАТРАТ                  */"Сырье (первич.)","Топливо (первич.)"
)
CLEARBLOCK ALL;
ENDFIX

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                  */"бу элемента затрат"
)
"Сумма"(
IF(@ISMBR(@LIST("Отсев агломерата","Окатыши МГОК","Окатыши ЛГОК",
"Окатыши Карельские","Руда марганцевая","Руда доменная МГОК",
"Руда доменная КЖРК","Железорудное сырье (ДЦ)","Доломит.","Известняк фр. 40-70")))
	"Сумма"->"Сырье (первич.)" = "Сумма";
ELSE
"Сумма"->"Топливо (первич.)" = "Сумма";
ENDIF 
)
ENDFIX
ENDFIX
ENDFIX

FIX(
/*МВЗ                           */"№1. Аглоцех" and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОДУКЦИЯ                        */"Агломерат бункерный"
/*ВИД ЗАТРАТ                     	*/"Отсев агломерата",
										"Концентрат КМА",
										"Концентрат ЛГОК",
										"Концентрат МГОК",
										"Концентрат СГОК",
										"Аглоруда Яковлевская",
										"Материалы железосодержащие АС",
										"Пыль колошниковая",
										"Флюс мелкофракционный АС",
										"Доломит.",
										"Известняк фр. 0-20",
										"Известняк фр. 20-40",
										"Известь со стороны",
										"Коксовая мелочь с печей",
										"Коксовая мелочь с РВО",
										"Коксовый орех +25",
										"Отсев кокса мелкофракционный АС",
										"Коксовая мелочь стор."

)
FIX(
/*Показатели						*/"Сумма"
/*ЭЛЕМЕНТЫ_ЗАТРАТ                  */"Сырье (первич.)"
)
CLEARBLOCK ALL;
ENDFIX
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                  */"бу элемента затрат"
)

"Сумма"(
	"Сумма"->"Сырье (первич.)" = "Сумма";
)
ENDFIX
ENDFIX
ENDFIX

FIX(
/*МВЗ                           */@RELATIVE("№6. ЦПДМШ",0) and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОДУКЦИЯ                        */"Щебень шлаковый","Щебень шлаковый в целом","Щебень шлаковый фр.5-20","Щебень шлаковый фр.10-40","Щебень шлаковый фр.20-40","Щебень шлаковый смесь 20-70.","Щебень шлаковый фр.40-70","Щебень шлаковый фр.50-250","Песок шлаковый фр. 0-5","Щебеночно-песчаная смесь фр. 0-10","Щебеночно-песчаная смесь фр. 0-70","Услуги по взвешиванию щебня","Скрап дробленый","Металлодобавка.","Чугун дробленый шлаковый","МК-250.","МК-80.","МК-50.","МК-10.","Скрап переработанный.","Огневая резка металлолом","Окалина переработанная"
/*ВИД ЗАТРАТ                     	*/"Окалина переработанная_",
										"Скрап с разливочных машин",
										"Графитовый чугунный скрап",
										"Лом черных металлов в целом",
										"20 А  Брак чугун.литья (негабарит)",
										"27 А Окалина кузнечного и прокатного производства",
										"5 А Негабарит.стальной лом и отходы",
										"16 А Стружка стальная негабаритная",
										"3 А Литники стальные (габаритные)",
										"19 А Литники чугунные (габаритные)"
)


FIX(
/*Показатели						*/"Сумма"
/*ЭЛЕМЕНТЫ_ЗАТРАТ                  */"Сырье (первич.)"
)
CLEARBLOCK ALL;
ENDFIX
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                  */"бу элемента затрат"
)

"Сумма"(
	"Сумма"->"Сырье (первич.)" = "Сумма";
)
ENDFIX
ENDFIX
ENDFIX

ENDFIX
FIX(
/*МВЗ                             */@LIST("Уч УОШ","Уч по разработке шлама аглодоменного","Уч металлопродукции")
									AND @RELATIVE({МВЗ},0)
)

FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */@Relative("Всего первичным по элементам затрат.", 0)
/*ЦФО                            */"ПЭО"
/*КОНТРАГЕНТЫ                    */"бу контрагента"
/*НАПРАВЛЕНИЕ                    */"бу направления"
/*ПРОЧЕЕ                       */
/*СЧЕТА БАЛАНСА                 */@RELATIVE("Начисление",0)
/*МВЗ ПОЛУЧАТЕЛЬ                 */
/*ВАЛЮТА                        */"RUR"
/*ВИД ЗАТРАТ                     */
/*СТАТЬИ                       */
/*СЦЕНАРИЙ                       */{СЦЕНАРИЙ}
/*ПЕРИОД                         */@ILDESCENDANTS({СПИСОК_ПЕРИОД}) and @RELATIVE("Всего год",0)
/*ВЕРСИЯ                          */{ВЕРСИЯ}
/*ГОД                              */{ГОД}
/*ПРОДУКЦИЯ                       */"Материал железосодержащий с УОШ","Шлам по ТУ 14-127-330.","МК-10."
/*ПОКАЗАТЕЛИ                        */"Сумма"
/*МВЗ                             */

)

FIXPARALLEL(8,@DESCENDANTS("ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"))
FIX(
/*МВЗ ПОЛУЧАТЕЛЬ                 */@RELATIVE("Итого по МВЗ (пол-ль)",0)
/*ПРОЧЕЕ                       */@RELATIVE("Итого по прочим справочникам",0)
/*ВИД_ЗАТРАТ                    */
)
AGG("ВИД_ЗАТРАТ");
ENDFIX


FIX(
/*МВЗ ПОЛУЧАТЕЛЬ                 */@RELATIVE("Итого по МВЗ (пол-ль)",0)
/*ВИД_ЗАТРАТ                    */"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
/*ПРОЧЕЕ                       */
)
AGG("ПРОЧЕЕ");
ENDFIX

FIX(
/*МВЗ ПОЛУЧАТЕЛЬ                 */
/*ВИД_ЗАТРАТ                    */"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
/*ПРОЧЕЕ                       */"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
)
AGG("МВЗ ПОЛУЧАТЕЛЬ");
ENDFIX

ENDFIXPARALLEL

ENDFIX

ENDFIX
FIX(
/*МВЗ                             */"№1. Аглоцех"and @RELATIVE({МВЗ},0)
)

FIX(
/*ПРОЧЕЕ                         */"Прочее по ЭР"
/*ПРОДУКЦИЯ                       */"бу вида продукции"
/*НАПРАВЛЕНИЕ                       */"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ                    */@Relative("Всего первичным по элементам затрат.", 0)
/*МВЗ ПОЛУЧАТЕЛЬ                    */"бу МВЗ (пол-ль)"
/*ВАЛЮТА                          */"RUR"
/*ПЕРИОД                          */
/*КОНТРАГЕНТЫ                       */"бу контрагента"
/*ВЕРСИЯ                          */{ВЕРСИЯ}
/*ГОД                             */{ГОД}
/*МВЗ                             */
/*СЦЕНАРИЙ                       */{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ                      */"Материалы железосодержащие с УОШ","Шлам по ТУ 14-127-330","МК-10"
/*ЦФО                             */"ПЭО"
/*СТАТЬИ                          */"бу Статьи"
/*ПОКАЗАТЕЛИ                       */
/*СЧЕТА БАЛАНСА                    */
)


/*Раскладываем остатки по среднегодовым элементам затрат*/
FIX(
/*СЧЕТА БАЛАНСА                    */"10_Остаток на начало"
/*ПЕРИОД                          */"Январь"
)


SET CREATENONMISSINGBLK ON;
"Сумма"(
IF(@ISMBR("Материалы железосодержащие с УОШ"->"Январь"))
   IF("Всего первичным по элементам затрат."->"Сумма"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"+0==0)
   /*нет января берем среднюю по году*/
   "Сумма"= ("Сумма"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"/"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало")
         /("Всего первичным по элементам затрат."->"Сумма"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"Всего год"
            /"бу видов затрат"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR"->"Всего год")
         *("Сумма"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"Всего год"
         /"бу видов затрат"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR"->"Всего год")
         *"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало";
   ELSE 
   "Сумма"= ("Сумма"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"/"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало")
         /("Всего первичным по элементам затрат."->"Сумма"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"
            /"бу видов затрат"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR")
         *("Сумма"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"
         /"бу видов затрат"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR")
         *"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало";
   ENDIF
ELSEIF(@ISMBR("Шлам по ТУ 14-127-330"->"Январь"))
IF("Всего первичным по элементам затрат."->"Сумма"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"+0==0)
   /*нет января берем среднюю по году*/
   "Сумма"= ("Сумма"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"/"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало")
         /("Всего первичным по элементам затрат."->"Сумма"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"Всего год"
            /"бу видов затрат"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR"->"Всего год")
         *("Сумма"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"Всего год"
         /"бу видов затрат"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR"->"Всего год")
         *"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало";
   ELSE 
   "Сумма"= ("Сумма"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"/"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало")
         /("Всего первичным по элементам затрат."->"Сумма"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"
            /"бу видов затрат"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR")
         *("Сумма"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"
         /"бу видов затрат"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR")
         *"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало";
   ENDIF
ELSEIF(@ISMBR("МК-10"->"Январь"))
IF("Всего первичным по элементам затрат."->"Сумма"->"Уч металлопродукции"->"МК-10."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"+0==0)
   /*нет января берем среднюю по году*/
   "Сумма"= ("Сумма"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"/"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало")
         /("Всего первичным по элементам затрат."->"Сумма"->"Уч металлопродукции"->"МК-10."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"Всего год"
            /"бу видов затрат"->"Уч металлопродукции"->"МК-10."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR"->"Всего год")
         *("Сумма"->"Уч металлопродукции"->"МК-10."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"Всего год"
         /"бу видов затрат"->"Уч металлопродукции"->"МК-10."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR"->"Всего год")
         *"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало";
   ELSE 
   "Сумма"= ("Сумма"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"/"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало")
         /("Всего первичным по элементам затрат."->"Сумма"->"Уч металлопродукции"->"МК-10."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"
            /"бу видов затрат"->"Уч металлопродукции"->"МК-10."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR")
         *("Сумма"->"Уч металлопродукции"->"МК-10."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"
         /"бу видов затрат"->"Уч металлопродукции"->"МК-10."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR")
         *"Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало";
   ENDIF
      
ENDIF      )

SET CREATENONMISSINGBLK ON;



ENDFIX 

FIX(
/*СЧЕТА БАЛАНСА                    */"10_Поступление"
/*ПЕРИОД                          */@RELATIVE("Всего год",0)
)


SET CREATENONMISSINGBLK ON;
"Сумма"(
IF(@ISMBR("Материалы железосодержащие с УОШ"))
   "Сумма"= "Сумма"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ";
ELSEIF(@ISMBR("Шлам по ТУ 14-127-330"))
   "Сумма"= "Сумма"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ";
ELSEIF(@ISMBR("МК-10"))
   "Сумма"= "Сумма"->"Уч металлопродукции"->"МК-10."->"МВЗ Получатели"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"20_Начисление"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ";
ENDIF)

SET CREATENONMISSINGBLK ON;

ENDFIX 



FIX(
/*ПОКАЗАТЕЛИ                       */"Сумма"
/*СЧЕТА БАЛАНСА                    */
/*ПЕРИОД                          */@RELATIVE("Всего год",0)
)
SET CREATENONMISSINGBLK ON;
LOOP(12)
"10_Списание"(
IF(@ISMBR("Материалы железосодержащие с УОШ"))

   "10_Списание"->"Сумма"= ("Сумма"->"10_Остаток на начало"->"январь"
            + @SUMRANGE("Сумма"->"10_Поступление",@LIST("январь": @CURRMBR("ПЕРИОД")))
           )
            /("Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"->"Январь"
            + @SUMRANGE("бу видов затрат"->"Уч УОШ"->"Материал железосодержащий с УОШ"->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR",@LIST("январь": @CURRMBR("ПЕРИОД"))) 
            )
            *"№1. Аглоцех"->"бу контрагента"->"бу направления"->"Агломерат бункерный"->"бу прочих справочников"->"ПЭО"->"бу элемента затрат"->"ЦЕХОВАЯ СЕБЕСТОИМОСТЬ"->"20_Начисление"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR";

   "10_Остаток на конец"->"Сумма"   = "10_Остаток на начало"+"10_Поступление"-"10_Списание";
ELSEIF(@ISMBR("Шлам по ТУ 14-127-330"))
   "10_Списание"->"Сумма"= ("Сумма"->"10_Остаток на начало"->"январь"
            + @SUMRANGE("Сумма"->"10_Поступление",@LIST("январь": @CURRMBR("ПЕРИОД")))
           )
            /("Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"->"Январь"
            + @SUMRANGE("бу видов затрат"->"Уч УОШ"->"Шлам по ТУ 14-127-330."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR",@LIST("январь": @CURRMBR("ПЕРИОД"))) 
            )
            *"№1. Аглоцех"->"бу контрагента"->"бу направления"->"Агломерат бункерный"->"бу прочих справочников"->"ПЭО"->"бу элемента затрат"->"ЦЕХОВАЯ СЕБЕСТОИМОСТЬ"->"20_Начисление"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR";

   "10_Остаток на конец"->"Сумма"   = "10_Остаток на начало"+"10_Поступление"-"10_Списание";
ELSEIF(@ISMBR("МК-10"))
   "10_Списание"->"Сумма"= ("Сумма"->"10_Остаток на начало"->"январь"
            + @SUMRANGE("Сумма"->"10_Поступление",@LIST("январь": @CURRMBR("ПЕРИОД")))
           )
            /("Кол-во"->"бу элемента затрат"->"Сырье."->"10_Остаток на начало"->"Январь"
            + @SUMRANGE("бу видов затрат"->"Уч металлопродукции"->"МК-10."->"ПЭО"->"бу элемента затрат"->"Кол-во с учетом годного выхода."->"бу прочих справочников"->"20_Начисление"->"Кол-во"->"RUR",@LIST("январь": @CURRMBR("ПЕРИОД"))) 
           )
            *"№1. Аглоцех"->"бу контрагента"->"бу направления"->"Агломерат бункерный"->"бу прочих справочников"->"ПЭО"->"бу элемента затрат"->"ЦЕХОВАЯ СЕБЕСТОИМОСТЬ"->"20_Начисление"->"бу МВЗ (пол-ль)"->"Кол-во"->"RUR";

   /*"10_Остаток на конец"->"Сумма"   = "10_Остаток на начало"+"10_Поступление"-"10_Списание";*/

ENDIF)
SET CREATENONMISSINGBLK OFF;
ENDLOOP
ENDFIX 

ENDFIX 
ENDFIX]]></script>
    </rule>
  </rules>
  <components></components>
</HBRRepo>