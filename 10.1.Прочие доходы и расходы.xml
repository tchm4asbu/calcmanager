<?xml version="1.0" encoding="UTF-8"?>
<HBRRepo>
  <variables>
    <variable id="1" name="ГОД" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Year</property>
      <property name="prompt_text">Выберите Год</property>
      <property name="scope">ruleset</property>
      <value>FY18</value>
    </variable>
    <variable id="2" name="ВЕРСИЯ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Version</property>
      <property name="prompt_text">Выберите Версию</property>
      <property name="scope">ruleset</property>
      <value>Рабочая_1</value>
    </variable>
    <variable id="3" name="СЦЕНАРИЙ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Scenario</property>
      <property name="prompt_text">Выберите Сценарий</property>
      <property name="scope">ruleset</property>
      <value>Проект</value>
    </variable>
    <variable id="4" name="МВЗ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">МВЗ</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите МВЗ</property>
      <property name="scope">ruleset</property>
      <value>"Итого по МВЗ"</value>
    </variable>
  </variables>
  <rulesets></rulesets>
  <rules>
    <rule id="1" name="10.1.Прочие доходы и расходы" product="Planning">
      <property name="application">ТЧМ</property>
      <property name="plantype">Plan1</property>
      <property name="display_label">10.1.Прочие доходы и расходы</property>
      <property name="enableNotifications">false</property>
      <property name="enablePostProcessing">false</property>
      <property name="enablePreProcessing">false</property>
      <variable_references>
        <variable_reference id="2" name="ВЕРСИЯ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">10.1.Прочие доходы и расходы</property>
          <property name="seq">1</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="1" name="ГОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">10.1.Прочие доходы и расходы</property>
          <property name="seq">2</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="3" name="СЦЕНАРИЙ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">10.1.Прочие доходы и расходы</property>
          <property name="seq">3</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="4" name="МВЗ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">10.1.Прочие доходы и расходы</property>
          <property name="seq">4</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
      </variable_references>
      <script><![CDATA[SET AGGMISSG ON;
SET UPDATECALC OFF;
SET CREATEBLOCKONEQ OFF;
SET CREATENONMISSINGBLK OFF;
SET FRMLBOTTOMUP OFF;
SET REMOTECALC OFF;
SET CALCPARALLEL 1;
SET CALCTASKDIMS 1;
SET EMPTYMEMBERSETS ON;
SET FRMLRTDYNAMIC OFF;
SET MSG INFO;
/* Проверка корректности рассчитываемого среза данных */

FIX(
/* ВАЛЮТА							*/	"бу валюты"
/* ПЕРИОД							*/	"P0"
/* ГОД								*/	"No Year"
/* ВЕРСИЯ							*/	
/* СЦЕНАРИЙ							*/	
/* ЦФО								*/	"бу ЦФО"
/* МВЗ								*/	"бу МВЗ"
/* МВЗ ПОЛУЧАТЕЛЬ					*/	"бу МВЗ (пол-ль)"
/* СЧЕТА БАЛАНСА					*/	"80_Увеличение"
/* СТАТЬИ							*/	
/* ПОКАЗАТЕЛИ						*/	"Сумма"
/* ВИД ЗАТРАТ						*/	"бу видов затрат"
/* ПРОДУКЦИЯ						*/	"бу вида продукции"
/* КОНТРАГЕНТЫ						*/	"бу контрагента"
/* НАПРАВЛЕНИЕ	*/	"бу направления"
/* ЭЛЕМЕНТЫ_ЗАТРАТ					*/	"бу элемента затрат"
/* ПРОЧЕЕ							*/	"бу прочих справочников"

)
  SET CREATENONMISSINGBLK ON;

  
  var ErrFlagScenario=0;
  var ErrFlagVersion=0;
  var NextM=2;
  /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА СЦЕНАРИЯ */
  FIX(/* Сценарий */ {СЦЕНАРИЙ} AND @LIST(&ОТКРЫТЫЕ_СЦЕНАРИИ))
    FIX(
    /* Сценарий */ 
    /* Версия   */ "Рабочая 1"
    )
     "бу статьи" (
     IF (ErrFlagScenario==0)
            ErrFlagScenario=1;
     ENDIF
     );

    ENDFIX
  ENDFIX

   /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА ВЕРСИИ */
  FIX(/* Версия  */ {ВЕРСИЯ} AND @LIST(&ОТКРЫТЫЕ_ВЕРСИИ))
    FIX(
    /* Сценарий */ "Проект"
    /* Версия   */ 
    )
     "бу статьи" (
     IF (ErrFlagVersion==0)
            ErrFlagVersion=1;
     ENDIF
     );
    ENDFIX
  ENDFIX

  /* ВЫВОД СООБЩЕНИЙ О НЕКОРРЕКТНОМ СРЕЗЕ */
  FIX(
  /* Сценарий     */ "Проект"
  /* Версия       */ "Рабочая 1"
  )

   "бу статьи" (
    IF (ErrFlagScenario==0)
       @RETURN("Выбран сценарий, закрытый для расчета. Расчет не произведен.",ERROR);
    ENDIF
    IF (ErrFlagVersion==0)
       @RETURN("Выбрана версия, закрытая для расчета. Расчет не произведен.",ERROR);
    ENDIF
    )

   ENDFIX
ENDFIX
SET CREATENONMISSINGBLK OFF;
/* AGG Вид затрат 2.9.4.Соц_сметы */

FIX(
/*ЦФО 								*/"ПЭО"
/*ВАЛЮТА 							*/"RUR"
/*КОНТРАГЕНТЫ 						*/"бу контрагента"
/*МВЗ 								*/"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."
/*НАПРАВЛЕНИЕ 						*/"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ					*/@RELATIVE("Всего по элементам затрат в смете",0)
/*ГОД								*/{ГОД}
/*ВЕРСИЯ							*/{ВЕРСИЯ}
/*ПЕРИОД							*/@RELATIVE("Всего год",0)
/*СЦЕНАРИЙ							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ						*/
/*ПРОЧЕЕ							*/@RELATIVE("Всего по прочим справочникам в смете",0)
/*МВЗ ПОЛУЧАТЕЛЬ					*/
/*ПРОДУКЦИЯ							*/"бу вида продукции"
/*СТАТЬИ							*/@RELATIVE("ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ",0)
/*СЧЕТА БАЛАНСА						*/"29_Поступление"
/*ПОКАЗАТЕЛИ						*/"Сумма"
)
FIX(
/*МВЗ ПОЛУЧАТЕЛЬ					*/"бу МВЗ (пол-ль)",@RELATIVE("ТЧМ итого (пол-ль)",0)
)
AGG("ВИД ЗАТРАТ" );
ENDFIX

FIX(
/*МВЗ ПОЛУЧАТЕЛЬ					*/"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("МВЗ ПОЛУЧАТЕЛЬ" );
ENDFIX

ENDFIX

/* AGG для расчета курсовых разниц с формы 1.5.1 */
FIX(
/*ЦФО 								*/"Отд ВЭС"
/*ВАЛЮТА 							*/"RUR", "EUR", "USD", "Рубль (расчет)"
/*КОНТРАГЕНТЫ 						*/"Прочие внешние"
/*МВЗ 								*/"ТЧМ в целом", "ТЧМС в целом"
/*НАПРАВЛЕНИЕ 						*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ					*/"бу элемента затрат"
/*ГОД								*/{ГОД}
/*ВЕРСИЯ							*/{ВЕРСИЯ}
/*ПЕРИОД							*/@RELATIVE("Всего год",0)
/*СЦЕНАРИЙ							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ						*/@RELATIVE("Всего по складам",0)
/*ПРОЧЕЕ							*/
/*МВЗ ПОЛУЧАТЕЛЬ					*/"бу МВЗ (пол-ль)"
/*ПРОДУКЦИЯ							*/
/*СТАТЬИ							*/"Реализация осн продукции на экспорт", "Реализация осн продукции в СНГ"
/*СЧЕТА БАЛАНСА						*/"Курсовая разница"
/*ПОКАЗАТЕЛИ						*/"Сумма"
)
    FIX(
    /*НАПРАВЛЕНИЕ 						*/@RELATIVE("Экспорт",0)
    /*ПРОЧЕЕ							*/@RELATIVE("Всего по типам договоров",0)
    /*ПРОДУКЦИЯ							*/
    )
        AGG("ПРОДУКЦИЯ" );
    ENDFIX
    
    FIX(
    /*НАПРАВЛЕНИЕ 						*/
    /*ПРОЧЕЕ							*/@RELATIVE("Всего по типам договоров",0)
    /*ПРОДУКЦИЯ							*/"ПРОДУКЦИЯ ТЧМ и ТЧМС"
    )
        AGG("НАПРАВЛЕНИЕ" );
    ENDFIX
    
    FIX(
    /*НАПРАВЛЕНИЕ 						*/"Направления"
    /*ПРОЧЕЕ							*/
    /*ПРОДУКЦИЯ							*/"ПРОДУКЦИЯ ТЧМ и ТЧМС"
    )
        AGG("ПРОЧЕЕ" );
    ENDFIX
ENDFIX
FIX(
/*ЦФО                         */"ПЭО"
/*ВАЛЮТА                      */"RUR"
/*КОНТРАГЕНТЫ                   */
/*МВЗ                         */(@LIST("ТЧМ в целом","ТЧМС в целом") and @RELATIVE({МВЗ},0)) 
/*НАПРАВЛЕНИЕ                   */"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ               */"бу элемента затрат"
/*ГОД                        */{ГОД}
/*ВЕРСИЯ                     */{ВЕРСИЯ}
/*ПЕРИОД                     */@RELATIVE("Всего год",0)
/*СЦЕНАРИЙ                     */{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ                  */
/*ПРОЧЕЕ                     */"бу прочих справочников"
/*МВЗ ПОЛУЧАТЕЛЬ               */"бу МВЗ (пол-ль)"
/*ПРОДУКЦИЯ                     */"бу вида продукции"
/*СТАТЬИ                     */
/*СЧЕТА БАЛАНСА                  */
/*ПОКАЗАТЕЛИ                  */
)
VAR VarRateUSD, VarRateEUR, VarRateDZ, VarRateKZ, VAR_CURS;

/*  Расчет  */

FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */
/*ПОКАЗАТЕЛИ                  */"Сумма"
/*СЧЕТА БАЛАНСА                  */
)

DATACOPY "Резервы по налогам"->"96_Списание" TO "Восстановление резервов по налогам"->"91_Прочие доходы и расходы" ; 
DATACOPY "Резерв под обесценение ТМЦ"->"96_Списание" TO "Восстановление резервов по безнадежным долгам"->"91_Прочие доходы и расходы" ; 
DATACOPY "Резервы под сомнительную дебиторскую задолженность"->"96_Списание" TO "Восстановление резервов по запасам"->"91_Прочие доходы и расходы" ; 

DATACOPY "Резервы по налогам"->"96_Начисление" TO "Резервы по налогам"->"91_Прочие доходы и расходы" ; 
DATACOPY "Резервы под сомнительную дебиторскую задолженность"->"96_Начисление" TO "Резерв по безнадежным долгам"->"91_Прочие доходы и расходы" ; 
DATACOPY "Резерв под обесценение ТМЦ"->"96_Начисление" TO "Резерв по запасам"->"91_Прочие доходы и расходы" ; 

ENDFIX

SET CREATENONMISSINGBLK ON;

/*  Расчет  */

FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Восстановление прочих резервов под обязательства"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма" = "Сумма"->"Резервы предстоящих расходов и платежей"->"Всего по срочности"->"96_Списание" + "Сумма"->"Резервы под сомнительную дебиторскую задолженность"->"96_Списание" 
+ "Сумма"->"Прочие резервы"->"Всего по срочности"->"96_Списание";

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"Пени и штрафы по налогам и сборам"
/*СТАТЬИ                     */"Оплата налогов"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма" = "Сумма"->/*"Прочие внешние"->*/"бу уровней бюджета"->"Бухгалтерия"->"Оплата налогов"->"68_Начислено налога";

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Изменение прочих резервов под обязательства"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма" = "Сумма"->"Резервы предстоящих расходов и платежей" ->"Всего по срочности" ->"96_Начисление" +"Сумма"->"Резервы под сомнительную дебиторскую задолженность"->"96_Начисление"
+ "Сумма"->"Прочие резервы" ->"Всего по срочности" ->"96_Начисление";

ENDFIX


FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Расходы от переоценки ЦБ"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма" (
IF("Сумма" ->"Долгосрочные"->"Всего по видам финвложений"->"Финансовый отд"->"бу статьи"->"58_Прочее увелич/уменьш (+/-)" >0)
-"Сумма" ->"Долгосрочные"->"Всего по видам финвложений"->"Финансовый отд"->"бу статьи"->"58_Прочее увелич/уменьш (+/-)" ;
ELSE 
#missing;
ENDIF
)

ENDFIX


FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Расходы от выбытия инвестиций в дочерние компании"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма"  = "Сумма" ->"Долгосрочные"->"Акции и вклады в УК (инвестиции)"->"Финансовый отд"->"бу статьи"->"58_Возврат вложений";

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */"бу контрагента"
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"НДС не возмещаемый"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма"  = "Сумма"->"НДС"->"Прочие внешние"->"Бухгалтерия"->"бу статьи"->"НДС по книге покупок в расчет" + "Сумма"-> "НДС"->"Прочие внешние"->"Бухгалтерия"->"бу статьи"->"НДС к вычету по внутр рынку" ;

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Списание кап.затрат в расходы периода"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма"  = "Сумма"->"Прочие внешние"->"Отдел инвестиций"->"Всего по проектам"->"Инвест затраты (без статей)"->"08_Списание при реализации" ;

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Расход от выбытия ОС, НМА"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма"  = "Сумма"->"Амортизация ОС и НМА"->"Здания"->"Финансовый отд"->"Амортизация ОС и НМА."->"01_Продажа (перв ст-ть)"  
- "Сумма"->"Амортизация ОС и НМА"->"Здания"->"Финансовый отд"->"Амортизация ОС и НМА."->"02_Продажа (аморт-ия)" ;

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"РБП (прочие)"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма"  = "Сумма"->/*"Итого по контрагентам"->*/"Прочие РБП"->"97_Начисление";

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */
/*ВИД ЗАТРАТ                  */
/*СТАТЬИ                     */"Расходы объектов социальной сферы"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

   FIX(
    /*КОНТРАГЕНТЫ                   */@Relative("Итого по контрагентам", 0)
   /*ВИД ЗАТРАТ                  */"Базы отдыха, турбазы", "Цех питания", "Стрелковый стенд", "ФОК.", "Соцобъекты"
   )
       CLEARDATA "Сумма";
    ENDFIX

   FIX(
    /*КОНТРАГЕНТЫ                   */"бу контрагента"
   /*ВИД ЗАТРАТ                  */"Базы отдыха, турбазы" /* Остальные тоже считаем: "Цех питания", "Стрелковый стенд", "ФОК.", "Соцобъекты"*/
   )
    
      "Сумма"(
      IF (@ISMBR("ТЧМ в целом"))
            "Базы отдыха, турбазы" = "БО Металлург."->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"бу контрагента"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"29_Поступление"->"Всего по элементам затрат в смете"->"Всего по прочим справочникам в смете"->"МВЗ получатели";
            "Цех питания" = "№23. Цех питания"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"бу контрагента"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"29_Поступление"->"Всего по элементам затрат в смете"->"Всего по прочим справочникам в смете"->"МВЗ получатели";
            "Стрелковый стенд" = "Спортивно-стрелковый стенд"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"бу контрагента"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"29_Поступление"->"Всего по элементам затрат в смете"->"Всего по прочим справочникам в смете"->"МВЗ получатели";
            "ФОК." = "ФОК"->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"бу контрагента"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"29_Поступление"->"Всего по элементам затрат в смете"->"Всего по прочим справочникам в смете"->"МВЗ получатели";
            "Соцобъекты" = "Соцобъекты."->"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"бу контрагента"->"ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ"->"29_Поступление"->"Всего по элементам затрат в смете"->"Всего по прочим справочникам в смете"->"МВЗ получатели";
      ENDIF
      )
    ENDFIX
ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */"бу контрагента"
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Прочее (неденежное)"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)

"Сумма"  = "№12. Автохозяйство"->"бу контрагента"->"Услуги (сч 91;85)"->"Услуги автоцеха"->"№12 Автохозяйство"->"Реализация продукции вспомогательных цехов"->"20_Начисление"->"Сумма";

ENDFIX

FIX(
/*КОНТРАГЕНТЫ                   */"бу контрагента"
/*ВИД ЗАТРАТ                  */"бу видов затрат"
/*СТАТЬИ                     */"Курсовая разниц (положительная)", "Курсовая разница (отрицательная)"
/*ПОКАЗАТЕЛИ                  */
/*СЧЕТА БАЛАНСА                  */"91_Прочие доходы и расходы" 
)
"Сумма" (
"Сумма" = #MISSING;
/* исправил Горбузов 28.08.2018
VarRateUSD = "бу видов затрат"->"бу МВЗ"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"бу счета баланса"->"бу МВЗ (пол-ль)"->"Курс за период"->"USD";
VarRateEUR = "бу видов затрат"->"бу МВЗ"->"бу контрагента"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу ЦФО"->"бу элемента затрат"->"бу статьи"->"бу счета баланса"->"бу МВЗ (пол-ль)"->"Курс за период"->"EUR";


VarRateDZ  
    = -(("Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_ДЗ на конец"->"Сумма"->"USD"
    + "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_ДЗ на конец"->"Сумма"->"USD")
    * VarRateUSD
    + ("Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_ДЗ на конец"->"Сумма"->"EUR"
    + "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_ДЗ на конец"->"Сумма"->"EUR")
    * VarRateEUR
    + ("Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_ДЗ на конец"->"Сумма"->"RUR"
    + "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_ДЗ на конец"->"Сумма"->"RUR")
    - "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_ДЗ на конец"->"Сумма"->"Рубль (расчет)"
    - "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_ДЗ на конец"->"Сумма"->"Рубль (расчет)");
    
VarRateKZ
    = ("Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_КЗ на конец"->"Сумма"->"USD"
    + "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_КЗ на конец"->"Сумма"->"USD")
    * VarRateUSD
    + ("Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_КЗ на конец"->"Сумма"->"EUR"
    + "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_КЗ на конец"->"Сумма"->"EUR")
    * VarRateEUR
    + ("Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_КЗ на конец"->"Сумма"->"RUR"
    + "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_КЗ на конец"->"Сумма"->"RUR")
    - "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"62_КЗ на конец"->"Сумма"->"Рубль (расчет)"
    - "Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"62_КЗ на конец"->"Сумма"->"Рубль (расчет)";

    IF ((VarRateDZ + VarRateKZ) < 0)
        "Сумма"->"Курсовая разница (отрицательная)" = VarRateDZ + VarRateKZ;
    ELSE
        "Сумма"->"Курсовая разниц (положительная)" = VarRateDZ + VarRateKZ;
    ENDIF
*/

VAR_CURS =		/*курсовые разницы план на экспорт*/
				"Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"Курсовая разница"->"Сумма"->"USD"
				+"Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"Курсовая разница"->"Сумма"->"USD"
  	 			+"Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции в СНГ"->"Курсовая разница"->"Сумма"->"EUR"
                +"Всего по складам"->"Прочие внешние"->"Направления"->"ПРОДУКЦИЯ ТЧМ и ТЧМС"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Отд ВЭС"->"Реализация осн продукции на экспорт"->"Курсовая разница"->"Сумма"->"EUR"
                /*курсовые разницы по кредитам*/
                ;	
                        
  IF ( VAR_CURS+"бу видов затрат"->"Всего по контрагентам"->"Долгосрочные"->"бу вида продукции"->"Кредиты полученные"->"Финансовый отд"->"бу элемента затрат"->"бу статьи"->"66_Курс разницы (+/-)"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR" < 0)
        "Сумма"->"Курсовая разница (отрицательная)" = -1*(VAR_CURS+"бу видов затрат"->"Всего по контрагентам"->"Долгосрочные"->"бу вида продукции"->"Кредиты полученные"->"Финансовый отд"->"бу элемента затрат"->"бу статьи"->"66_Курс разницы (+/-)"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR");
  ELSE
        "Сумма"->"Курсовая разниц (положительная)" = VAR_CURS+"бу видов затрат"->"Всего по контрагентам"->"Долгосрочные"->"бу вида продукции"->"Кредиты полученные"->"Финансовый отд"->"бу элемента затрат"->"бу статьи"->"66_Курс разницы (+/-)"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR";
  ENDIF

)
    
ENDFIX


SET CREATENONMISSINGBLK OFF;
CLEARBLOCK EMPTY;

ENDFIX
FIX(
/*ЦФО 								*/"ПЭО"
/*ВАЛЮТА 							*/"RUR"
/*КОНТРАГЕНТЫ 						*/"бу контрагента"
/*МВЗ 								*/"№23. Цех питания","БО Металлург.","ФОК","Спортивно-стрелковый стенд","Соцобъекты."
/*НАПРАВЛЕНИЕ 						*/"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ					*/@RELATIVE("Всего по элементам затрат в смете",0)
/*ГОД								*/{ГОД}
/*ВЕРСИЯ							*/{ВЕРСИЯ}
/*ПЕРИОД							*/@RELATIVE("Всего год",0)
/*СЦЕНАРИЙ							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ						*/"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
/*ПРОЧЕЕ							*/@RELATIVE("Всего по прочим справочникам в смете",0)
/*МВЗ ПОЛУЧАТЕЛЬ					*/"бу МВЗ (пол-ль)",@RELATIVE("ТЧМ итого (пол-ль)",0),"МВЗ получатели"
/*ПРОДУКЦИЯ							*/"бу вида продукции"
/*СТАТЬИ							*/@RELATIVE("ПРОИЗВОДСТВЕННАЯ СЕБЕСТОИМОСТЬ",0)
/*СЧЕТА БАЛАНСА						*/"29_Поступление"
/*ПОКАЗАТЕЛИ						*/
)

CLEARDATA "Сумма";

ENDFIX

/* AGG для расчета курсовых разниц с формы 1.5.1 */
FIX(
/*ЦФО 								*/"Отд ВЭС"
/*ВАЛЮТА 							*/"RUR", "EUR", "USD", "Рубль (расчет)"
/*КОНТРАГЕНТЫ 						*/"Прочие внешние"
/*МВЗ 								*/"ТЧМ в целом", "ТЧМС в целом"
/*НАПРАВЛЕНИЕ 						*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ					*/"бу элемента затрат"
/*ГОД								*/{ГОД}
/*ВЕРСИЯ							*/{ВЕРСИЯ}
/*ПЕРИОД							*/@RELATIVE("Всего год",0)
/*СЦЕНАРИЙ							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ						*/@RELATIVE("Всего по складам",0)
/*ПРОЧЕЕ							*/
/*МВЗ ПОЛУЧАТЕЛЬ					*/"бу МВЗ (пол-ль)"
/*ПРОДУКЦИЯ							*/
/*СТАТЬИ							*/"Реализация осн продукции на экспорт", "Реализация осн продукции в СНГ"
/*СЧЕТА БАЛАНСА						*/"Курсовая разница"
/*ПОКАЗАТЕЛИ						*/"Сумма"
)
    FIX(
    /*НАПРАВЛЕНИЕ 						*/@RELATIVE("Экспорт",0)
    /*ПРОЧЕЕ							*/@RELATIVE("Всего по типам договоров",0)
    /*ПРОДУКЦИЯ							*/
    )
        CLEARDATA "ПРОДУКЦИЯ";
    ENDFIX
    
    FIX(
    /*НАПРАВЛЕНИЕ 						*/
    /*ПРОЧЕЕ							*/@RELATIVE("Всего по типам договоров",0)
    /*ПРОДУКЦИЯ							*/"ПРОДУКЦИЯ ТЧМ и ТЧМС"
    )
        CLEARDATA "НАПРАВЛЕНИЕ";
    ENDFIX
    
    FIX(
    /*НАПРАВЛЕНИЕ 						*/"Направления"
    /*ПРОЧЕЕ							*/
    /*ПРОДУКЦИЯ							*/"ПРОДУКЦИЯ ТЧМ и ТЧМС"
    )
        CLEARDATA "ПРОЧЕЕ";
    ENDFIX
ENDFIX]]></script>
    </rule>
  </rules>
  <components></components>
</HBRRepo>