<?xml version="1.0" encoding="UTF-8"?>
<HBRRepo>
  <variables>
    <variable id="1" name="СПИСОК_ПЕРИОД" product="Planning" type="members" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">ПЕРИОД</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите 1 или несколько месяцев</property>
      <property name="scope">ruleset</property>
      <property name="useLastValue">true</property>
      <value>"Всего год"</value>
    </variable>
    <variable id="2" name="ГОД" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Year</property>
      <property name="prompt_text">Выберите Год</property>
      <property name="scope">ruleset</property>
      <value>FY18</value>
    </variable>
    <variable id="3" name="ВЕРСИЯ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Version</property>
      <property name="prompt_text">Выберите Версию</property>
      <property name="scope">ruleset</property>
      <value>Рабочая_1</value>
    </variable>
    <variable id="4" name="СЦЕНАРИЙ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Scenario</property>
      <property name="prompt_text">Выберите Сценарий</property>
      <property name="scope">ruleset</property>
      <value>Проект</value>
    </variable>
    <variable id="5" name="МВЗ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">МВЗ</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите МВЗ</property>
      <property name="scope">ruleset</property>
      <value>"Итого по МВЗ"</value>
    </variable>
  </variables>
  <rulesets></rulesets>
  <rules>
    <rule id="1" name="13.11.1.Смета_ТП_ЭЗ_ТЧМ_xx" product="Planning">
      <property name="description">Смета ТП ТЧМ</property>
      <property name="application">ТЧМ</property>
      <property name="plantype">Plan1</property>
      <property name="display_label">13.11.1.Смета_ТП_ЭЗ_ТЧМ_xx</property>
      <property name="enableNotifications">false</property>
      <property name="enablePostProcessing">false</property>
      <property name="enablePreProcessing">false</property>
      <variable_references>
        <variable_reference id="3" name="ВЕРСИЯ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.11.1.Смета_ТП_ЭЗ_ТЧМ_xx</property>
          <property name="seq">1</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="4" name="СЦЕНАРИЙ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.11.1.Смета_ТП_ЭЗ_ТЧМ_xx</property>
          <property name="seq">2</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="2" name="ГОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.11.1.Смета_ТП_ЭЗ_ТЧМ_xx</property>
          <property name="seq">3</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="5" name="МВЗ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.11.1.Смета_ТП_ЭЗ_ТЧМ_xx</property>
          <property name="seq">4</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="1" name="СПИСОК_ПЕРИОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">13.11.1.Смета_ТП_ЭЗ_ТЧМ_xx</property>
          <property name="seq">5</property>
          <property name="type">4</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
      </variable_references>
      <script><![CDATA[SET AGGMISSG ON;
SET UPDATECALC OFF;
SET CREATEBLOCKONEQ OFF;
SET CREATENONMISSINGBLK OFF;
SET FRMLBOTTOMUP OFF;
SET REMOTECALC OFF;
SET CALCPARALLEL 1;
SET CALCTASKDIMS 1;
SET EMPTYMEMBERSETS ON;
SET FRMLRTDYNAMIC OFF;
SET MSG INFO;
/* Проверка корректности рассчитываемого среза данных */

FIX(
/* ВАЛЮТА							*/	"бу валюты"
/* ПЕРИОД							*/	"P0"
/* ГОД								*/	"No Year"
/* ВЕРСИЯ							*/	
/* СЦЕНАРИЙ							*/	
/* ЦФО								*/	"бу ЦФО"
/* МВЗ								*/	"бу МВЗ"
/* МВЗ ПОЛУЧАТЕЛЬ					*/	"бу МВЗ (пол-ль)"
/* СЧЕТА БАЛАНСА					*/	"80_Увеличение"
/* СТАТЬИ							*/	
/* ПОКАЗАТЕЛИ						*/	"Сумма"
/* ВИД ЗАТРАТ						*/	"бу видов затрат"
/* ПРОДУКЦИЯ						*/	"бу вида продукции"
/* КОНТРАГЕНТЫ						*/	"бу контрагента"
/* НАПРАВЛЕНИЕ	*/	"бу направления"
/* ЭЛЕМЕНТЫ_ЗАТРАТ					*/	"бу элемента затрат"
/* ПРОЧЕЕ							*/	"бу прочих справочников"

)
  SET CREATENONMISSINGBLK ON;

  
  var ErrFlagScenario=0;
  var ErrFlagVersion=0;
  var NextM=2;
  /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА СЦЕНАРИЯ */
  FIX(/* Сценарий */ {СЦЕНАРИЙ} AND @LIST(&ОТКРЫТЫЕ_СЦЕНАРИИ))
    FIX(
    /* Сценарий */ 
    /* Версия   */ "Рабочая 1"
    )
     "бу статьи" (
     IF (ErrFlagScenario==0)
            ErrFlagScenario=1;
     ENDIF
     );

    ENDFIX
  ENDFIX

   /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА ВЕРСИИ */
  FIX(/* Версия  */ {ВЕРСИЯ} AND @LIST(&ОТКРЫТЫЕ_ВЕРСИИ))
    FIX(
    /* Сценарий */ "Проект"
    /* Версия   */ 
    )
     "бу статьи" (
     IF (ErrFlagVersion==0)
            ErrFlagVersion=1;
     ENDIF
     );
    ENDFIX
  ENDFIX

  /* ВЫВОД СООБЩЕНИЙ О НЕКОРРЕКТНОМ СРЕЗЕ */
  FIX(
  /* Сценарий     */ "Проект"
  /* Версия       */ "Рабочая 1"
  )

   "бу статьи" (
    IF (ErrFlagScenario==0)
       @RETURN("Выбран сценарий, закрытый для расчета. Расчет не произведен.",ERROR);
    ENDIF
    IF (ErrFlagVersion==0)
       @RETURN("Выбрана версия, закрытая для расчета. Расчет не произведен.",ERROR);
    ENDIF
    )

   ENDFIX
ENDFIX
SET CREATENONMISSINGBLK OFF;
SET LOCKBLOCK HIGH;
FIX(
/*МВЗ              */@RELATIVE("ТЧМ Итого",0) and  @RELATIVE({МВЗ},0)
)
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ  */"бу элемента затрат"
/*ЦФО              */
/*КОНТРАГЕНТЫ      */"бу контрагента"
/*НАПРАВЛЕНИЕ      */
/*ПРОЧЕЕ           */"бу прочих справочников"
/*СЧЕТА БАЛАНСА    */"20_Выбытие"
/*МВЗ ПОЛУЧАТЕЛЬ   */
/*ВАЛЮТА           */"RUR"
/*ВИД ЗАТРАТ       */"бу видов затрат"
/*СТАТЬИ           */"бу статьи",
/*СЦЕНАРИЙ         */{СЦЕНАРИЙ}
/*ПЕРИОД           */@ILDESCENDANTS({СПИСОК_ПЕРИОД}) and @RELATIVE("Всего год",0)
/*ВЕРСИЯ           */{ВЕРСИЯ}
/*ГОД              */{ГОД}
/*ПРОДУКЦИЯ        */
/*ПОКАЗАТЕЛИ       */
/*МВЗ              */
)
    FIXPARALLEL(8,@DESCENDANTS("Всего по продукции"))
        FIX(
        /*ПОКАЗАТЕЛИ       					*/"Кол-во с учетом годного выхода"
        /*МВЗ ПОЛУЧАТЕЛЬ                     */@RELATIVE("Итого по МВЗ (пол-ль)", 0)        
        /*НАПРАВЛЕНИЕ                        */@RELATIVE("Всего по направлениям списания",0)
        )
        /*ЦФО                                */
        AGG("ЦФО");
        ENDFIX

        FIX(
        /*ПОКАЗАТЕЛИ       					*/"Кол-во с учетом годного выхода"
        /*ЦФО                                */"Центры финансовой ответсвенности"
        /*МВЗ ПОЛУЧАТЕЛЬ                     */
        /*НАПРАВЛЕНИЕ                        */@RELATIVE("Всего по направлениям списания",0)
        )
        AGG("МВЗ ПОЛУЧАТЕЛЬ");
        ENDFIX
        
         FIX(
        /*ПОКАЗАТЕЛИ       					*/
        /*ЦФО                                */"Центры финансовой ответсвенности"
        /*МВЗ ПОЛУЧАТЕЛЬ                     */"МВЗ получатели"
        /*НАПРАВЛЕНИЕ                        */"Тов. пр-ция (сч 43)"
        )
        "Доля %" = "Кол-во с учетом годного выхода"/"Кол-во с учетом годного выхода"->"Всего по направлениям списания";
        ENDFIX
        
    ENDFIXPARALLEL
    
    
ENDFIX
ENDFIX
FIX(
/*МВЗ  									*/@LIST("ТЧМ в целом", "ТЧМС в целом") and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОЧЕЕ 								*/@Relative("Итого по прочим справочникам", 0)
/*ПРОДУКЦИЯ  							*/@Relative("Всего по продукции",0)
/*НАПРАВЛЕНИЕ  							*/@Relative("Итого по направлениям", 0)
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/@Relative("Итого по элементам затрат", 0)
/*МВЗ ПОЛУЧАТЕЛЬ  						*/"бу МВЗ (пол-ль)"
/*ВАЛЮТА  								*/
/*ПЕРИОД           						*/@ILDESCENDANTS({СПИСОК_ПЕРИОД}) and @RELATIVE("Всего год",0)
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам", 0)
/*ВЕРСИЯ	  							*/{ВЕРСИЯ}
/*ГОД  									*/{ГОД}
/*МВЗ  									*/
/*СЦЕНАРИЙ  							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ 							*/"бу видов затрат", @Relative("Всего по складам", 0)
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*СТАТЬИ  								*/@RELATIVE("Поступления от реализации",0)
/*ПОКАЗАТЕЛИ  							*/
/*СЧЕТА БАЛАНСА  						*/"62_ДЗ на начало", "62_КЗ на начало","62_Реализация без НДС","62_Реализация с НДС",
													"62_Аванс", "62_Постоплата","62_ДЗ на конец", "62_КЗ на конец"
)

			DATACOPY "USD"->"Кол-во"  TO "Рубль (расчет)"->"Кол-во"  ;
			DATACOPY "EUR"->"Кол-во"   TO "Рубль (расчет)"->"Кол-во"  ;
			DATACOPY "RUR"->"Кол-во" TO "Рубль (расчет)"->"Кол-во"  ;
			DATACOPY "USD"->"Цена"  TO "Рубль (расчет)"->"Цена"  ;
			DATACOPY "EUR"->"Цена"   TO "Рубль (расчет)"->"Цена"  ;
			DATACOPY "RUR"->"Цена"   TO "Рубль (расчет)"->"Цена"  ;
			DATACOPY "USD"->"Тариф внеш."  TO "Рубль (расчет)"->"Тариф внеш."  ;
			DATACOPY "EUR"->"Тариф внеш."   TO "Рубль (расчет)"->"Тариф внеш."  ;
			DATACOPY "RUR"->"Тариф внеш."   TO "Рубль (расчет)"->"Тариф внеш."  ;
			DATACOPY "USD"->"Сумма"  TO "Рубль (расчет)"->"Сумма"  ;
			DATACOPY "EUR"->"Сумма"   TO "Рубль (расчет)"->"Сумма"  ;
			DATACOPY "RUR"->"Сумма"   TO "Рубль (расчет)"->"Сумма"  ;


			FIX(
			/*ВАЛЮТА  								*/"Рубль (расчет)"
			)

				"Кол-во" (
				"Кол-во"->"Рубль (расчет)" =#missing;

				"Кол-во"->"Рубль (расчет)"=	"RUR" +"USD" +"EUR";
				)


				"Цена" (
				"Цена"->"Рубль (расчет)" =#missing;

				"Цена"->"Рубль (расчет)"=
						"RUR"
						+"USD"*"USD"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)"
						+"EUR"*"EUR"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)";
				)
				
                "Цена тех." (
				"Цена тех."->"Рубль (расчет)" =#missing;

				"Цена тех."->"Рубль (расчет)"=
						"RUR"
						+"USD"*"USD"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)"
						+"EUR"*"EUR"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)";
				)
                
    			"Тариф тех." (
				"Тариф тех."->"Рубль (расчет)" =#missing;

				"Тариф тех."->"Рубль (расчет)"=
						"RUR"
						+"USD"*"USD"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)"
						+"EUR"*"EUR"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)";
				)

				"Тариф внеш." (
				"Тариф внеш."->"Рубль (расчет)" =#missing;

				"Тариф внеш."->"Рубль (расчет)"=
						"RUR"
						+"USD"*"USD"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)"
						+"EUR"*"EUR"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)";
				)

				"Сумма" (
				"Сумма"->"Рубль (расчет)" =#missing;

				"Сумма"->"Рубль (расчет)"=
						"RUR"
						+"USD"*"USD"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)"
						+"EUR"*"EUR"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)";
				)
                
                "Реализация с ЖД и польз. вагон"(
                "Реализация с ЖД и польз. вагон"->"Рубль (расчет)" =#missing;

				"Реализация с ЖД и польз. вагон"->"Рубль (расчет)"=
						"RUR"
						+"USD"*"USD"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)"
						+"EUR"*"EUR"->"Курс за период"->"бу счета баланса"->"бу ЦФО"->"бу видов затрат"->"бу контрагента"->"бу МВЗ"->"бу направления"->"бу вида продукции"->"бу прочих справочников"->"бу статьи"->"бу элемента затрат"->"бу МВЗ (пол-ль)";
				)
                
			ENDFIX
		ENDFIX
    ENDFIX
FIX(
/*МВЗ  									*/@LIST("ТЧМ в целом", "ТЧМС в целом") and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОЧЕЕ 								*/
/*ПРОДУКЦИЯ  							*/@Relative("Всего по продукции",0)
/*НАПРАВЛЕНИЕ  		*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/
/*МВЗ ПОЛУЧАТЕЛЬ  						*/"бу МВЗ (пол-ль)"
/*ВАЛЮТА  								*/ "USD", "EUR","Рубль (расчет)","RUR"
/*ПЕРИОД           						*/@ILDESCENDANTS({СПИСОК_ПЕРИОД}) and @RELATIVE("Всего год",0)
/*КОНТРАГЕНТЫ  							*/
/*ВЕРСИЯ	  							*/{ВЕРСИЯ}
/*ГОД  									*/{ГОД}
/*МВЗ  									*/
/*СЦЕНАРИЙ  							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ 							*/
/*ЦФО  									*/
/*СТАТЬИ  								*/@RELATIVE("Поступления от реализации",0)
/*ПОКАЗАТЕЛИ  							*/"Кол-во","Сумма","Реализация с ЖД и польз. вагон"
/*СЧЕТА БАЛАНСА  						*/"62_Реализация без НДС"
)
FIX(
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/@Relative("Всего по усл. поставки",0),"бу элемента затрат"
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам",0)
/*ПРОЧЕЕ 								*/@Relative ("Всего по типам договоров",0),"бу прочих справочников"
/*ВИД ЗАТРАТ 							*/@Relative("Всего по складам",0),"бу видов затрат"
)
AGG("НАПРАВЛЕНИЕ");
ENDFIX 
FIX(
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/@Relative("Всего по усл. поставки",0),"бу элемента затрат"
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам",0)
/*НАПРАВЛЕНИЕ  							*/"Направления"
/*ПРОЧЕЕ 								*/
/*ВИД ЗАТРАТ 							*/@Relative("Всего по складам",0),"бу видов затрат"
)
AGG("ПРОЧЕЕ");
ENDFIX 

FIX(
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/@Relative("Всего по усл. поставки",0),"бу элемента затрат"
/*КОНТРАГЕНТЫ  							*/@Relative("Итого по контрагентам",0)
/*НАПРАВЛЕНИЕ  							*/"Направления"
/*ПРОЧЕЕ 								*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/
)
AGG("ВИД_ЗАТРАТ");
ENDFIX 
FIX(
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/@Relative("Всего по усл. поставки",0),"бу элемента затрат"
/* КОНТРАГЕНТЫ							*/
/*НАПРАВЛЕНИЕ  							*/"Направления"
/*ПРОЧЕЕ 								*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("КОНТРАГЕНТЫ");
ENDFIX 

FIX(
/*ЦФО  									*/"Отд ВЭС","Упр по реал-ции прод-ции"
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/"Контрагенты ТЧМ и ТЧМС"
/* КОНТРАГЕНТЫ							*/
/*НАПРАВЛЕНИЕ  							*/"Направления"
/*ПРОЧЕЕ 								*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("ЭЛЕМЕНТЫ_ЗАТРАТ");
ENDFIX 

FIX(
/*ЦФО  									*/
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"
/* КОНТРАГЕНТЫ							*/"Контрагенты ТЧМ и ТЧМС"
/*НАПРАВЛЕНИЕ  							*/"Направления"
/*ПРОЧЕЕ 								*/"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"
/*ВИД ЗАТРАТ 							*/"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"
)
AGG("ЦФО");
ENDFIX 
ENDFIX 

ENDFIX
FIX(
/*МВЗ                             */@LIST("ТЧМ в целом") and @RELATIVE({МВЗ},0)
)
FIX("бу видов затрат",
"бу направления",
"бу прочих справочников",
"Упр по реал-ции прод-ции",
"бу элемента затрат",
"Выполнение работ, оказание услуг",
"62_Реализация без НДС",
"бу МВЗ (пол-ль)",
"Сумма",
"RUR")

AGG("КОНТРАГЕНТЫ");

ENDFIX

ENDFIX

/*зачищаем целевой срез*/
FIX(
/*МВЗ                             */@RELATIVE("ТЧМ Итого",0)and @RELATIVE({МВЗ},0)
)
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ЦФО                            */"ПЭО"
/*КОНТРАГЕНТЫ                    */"бу контрагента"
/*НАПРАВЛЕНИЕ                    */"бу направления"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */"Товарная продукция"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ВАЛЮТА                        */"RUR","Рубль (расчет)"
/*ВИД ЗАТРАТ                     */@RELATIVE("Всего по видам затрат",0),"бу видов затрат"
/*СТАТЬИ                        */"Кол-во с учетом годного выхода."
/*СЦЕНАРИЙ                        */{СЦЕНАРИЙ}
/*ПЕРИОД                             */@ILDESCENDANTS({СПИСОК_ПЕРИОД}) and @RELATIVE("Всего год",0)
/*ВЕРСИЯ                        */{ВЕРСИЯ}
/*ГОД                            */{ГОД}
/*ПРОДУКЦИЯ                     */@RELATIVE("Итого по продукции",0),"ПРОДУКЦИЯ ТЧМ и ТЧМС"
/*ПОКАЗАТЕЛИ                       */"Сумма","Кол-во","Цена"
/*МВЗ                           */
)
CLEARBLOCK ALL;
ENDFIX 
ENDFIX     

/*Расчитываем Кол-во, Цену и Предпологаемую Сумму выручки от продажи ТП*/
FIX(
/*МВЗ                             */@RELATIVE("ТЧМ Итого",0)and @RELATIVE({МВЗ},0)
)
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ЦФО                            */
/*КОНТРАГЕНТЫ                    */ "бу контрагента"
/*НАПРАВЛЕНИЕ                    */
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */
/*МВЗ ПОЛУЧАТЕЛЬ                 */
/*ВАЛЮТА                        */"RUR"
/*ВИД ЗАТРАТ                     */
/*СТАТЬИ                        */
/*СЦЕНАРИЙ                        */{СЦЕНАРИЙ}
/*ПЕРИОД                             */@ILDESCENDANTS({СПИСОК_ПЕРИОД}) and @RELATIVE("Всего год",0)
/*ВЕРСИЯ                        */{ВЕРСИЯ}
/*ГОД                            */{ГОД}
/*ПРОДУКЦИЯ                     */@RELATIVE("Всего по продукции",0)
/*ПОКАЗАТЕЛИ                        */
/*МВЗ                           */
)


/*создаем блоки для кол-ва ТП из ПП*/
DATACOPY "бу статьи"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода" to "Кол-во с учетом годного выхода."->"бу видов затрат"->"бу МВЗ (пол-ль)"->"Товарная продукция"->"бу направления"->"ПЭО"->"Кол-во";
DATACOPY "Энергозатраты по переделу"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода" to "Кол-во с учетом годного выхода."->"бу видов затрат"->"бу МВЗ (пол-ль)"->"Товарная продукция"->"бу направления"->"ПЭО"->"Кол-во";
DATACOPY "Содержание основных фондов"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода" to "Кол-во с учетом годного выхода."->"бу видов затрат"->"бу МВЗ (пол-ль)"->"Товарная продукция"->"бу направления"->"ПЭО"->"Кол-во";
DATACOPY "Энергозатраты на технологию"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода" to "Кол-во с учетом годного выхода."->"бу видов затрат"->"бу МВЗ (пол-ль)"->"Товарная продукция"->"бу направления"->"ПЭО"->"Кол-во";

/*количество товарной продукции*/
FIX(
/*ЦФО                            */"ПЭО"
/*НАПРАВЛЕНИЕ                    */"бу направления"
/*СЧЕТА БАЛАНСА                      */"Товарная продукция"
/*МВЗ ПОЛУЧАТЕЛЬ                 */   "бу МВЗ (пол-ль)"
/*ВИД ЗАТРАТ                     */"бу видов затрат"
/*ПОКАЗАТЕЛИ                      */
/*СТАТЬИ                        */"Кол-во с учетом годного выхода."
)

"Кол-во"(
IF(@ISDESC("Выполнение работ, оказание услуг."))
IF(@ISMBR("ТЧМ в целом"))

"ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода";
ELSE

#Missing;

ENDIF

ELSE

"бу статьи"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода"
+"Энергозатраты по переделу"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода"
+"Содержание основных фондов"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода"
+"Энергозатраты на технологию"->"бу видов затрат"->"МВЗ получатели"->"20_Выбытие"->"Тов. пр-ция (сч 43)"->"Центры финансовой ответсвенности"->"Кол-во с учетом годного выхода";

ENDIF
)

"Сумма"(

IF(@ISMBR(@SIBLINGS("Чугун передельный в целом"),@SIBLINGS("Чугун литейный в целом"),@SIBLINGS("Щебень шлаковый в целом"),@CHILDREN("Бетон В"),@CHILDREN("Бетон М"),"Азот газообразный в баллонах_", "Кислород газообразный в баллонах.","Азот газообразный в баллонах.", "Кислород газообразный в баллонах_"))

IF(@ISDESC("ТЧМ Итого"))

   IF("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"+0!=0)

   /*Сумма реализации основной продукции*/
   @ROUND(
   (
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"
   +
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"
   -
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"
   )
   /
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода",2)
   *
   "Кол-во";
   
   ELSE
   
   /*Сумма реализации основной продукции*/
      
      @ROUND(
      (
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR")
      +
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)")
      -
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR")
      )
      /
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->@PARENT("ПРОДУКЦИЯ")->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"),2)
      *"Кол-во";
      
   ENDIF  
ENDIF 

ELSEIF(@ISMBR("Чугун дробленый шлаковый"))

IF(@ISDESC("ТЧМ Итого"))

   IF("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"+0!=0)

   /*Сумма реализации основной продукции*/
   @ROUND(
   (
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"
   +
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"
   -
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"   
   )
   /
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода",2)
   *
   "Кол-во";

   ELSE
   
   /*Сумма реализации основной продукции*/

      @ROUND(
      (
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR")
      +
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)")
      -
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR")
      )
      /
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода",2)
      *"Кол-во";
      
   ENDIF  
ENDIF 

/* Отдельный пересчет для граншлака неообходим потому, что при реализации граншлак отгружают во влажном весе, а выручка отражается по сухому весу. Для этого используется коэффициент 0,92. */
ELSEIF(@ISMBR("Граншлак"))

IF(@ISDESC("ТЧМ Итого"))

   IF("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"+0!=0)

   /*Сумма реализации основной продукции*/
   @ROUND(
   (
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"
   +
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"
   -
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"   
   )
   /
   "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода",2)
   / 0.92
   *
   "Кол-во";

   ELSE
   
   /*Сумма реализации основной продукции*/

      @ROUND(
      (
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR")
      +
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)")
      -
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR")
      )
      /
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода",2)
      / 0.92
      *"Кол-во";
      
   ENDIF  
ENDIF


ELSE

IF(@ISDESC("ТЧМ Итого")  )
   IF("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"+0!=0)
   /*Сумма реализации основной продукции*/
      ("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"
      +
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"
      -
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"
      )/"Кол-во"*"Кол-во"        
      ;
   ELSE
   /*Сумма реализации основной продукции*/
      (@PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR")
      +
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)")
      -
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR")
      )/"Кол-во"*"Кол-во"        
      ;
   ENDIF 
ENDIF
ENDIF

)

set createnonmissingblk on;
"Сумма"(
IF(@ISMBR(@LIST("Услуги лаборатории", "Услуги по ведению бух. учета", "Прочие услуги", "Методическое руководство ГСС", "Услуги по взвешиванию щебня")))
IF(@ISMBR("ТЧМ в целом"))

"бу видов затрат"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"бу направления"->"бу прочих справочников"->"Упр по реал-ции прод-ции"->"бу элемента затрат"->"Выполнение работ, оказание услуг"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR";

ENDIF
/* Отдельный пересчет для"Азот газообразный в баллонах_" для перекладки на зеркальный баллон на котором собрана себестоимость*/
ELSEIF(@ISMBR("Азот газообразный в баллонах."))
IF(@ISDESC("ТЧМ Итого"))
   IF("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"->"Азот газообразный в баллонах_"+0!=0)
   /*Сумма реализации основной продукции*/
      ("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"->"Азот газообразный в баллонах_"
      +
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"->"Азот газообразный в баллонах_"
      -
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"->"Азот газообразный в баллонах_"
      )/"Кол-во"*"Кол-во"      
      ;
   ELSE
   /*Сумма реализации основной продукции*/
      (@PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"->"Азот газообразный в баллонах_")
      +
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"->"Азот газообразный в баллонах_")
      -
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"->"Азот газообразный в баллонах_")
      )/"Кол-во"*"Кол-во"      
      ;
   ENDIF 
    ENDIF
    
ELSEIF(@ISMBR("Кислород газообразный в баллонах_"))
IF(@ISDESC("ТЧМ Итого"))
   IF("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Кол-во"->"Валюты ввода"->"Кислород газообразный в баллонах."+0!=0)
   /*Сумма реализации основной продукции*/
      ("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"->"Кислород газообразный в баллонах."
      +
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"->"Кислород газообразный в баллонах."
      -
      "ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"->"Кислород газообразный в баллонах."
      )/"Кол-во"*"Кол-во"         
      ;
   ELSE
   /*Сумма реализации основной продукции*/
      (@PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Реализация с ЖД и польз. вагон"->"RUR"->"Кислород газообразный в баллонах.")
      +
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Поступления от реализации"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"Рубль (расчет)"->"Кислород газообразный в баллонах.")
      -
      @PRIOR("ВИДЫ ЗАТРАТ ТЧМ И ТЧМС"->"ТЧМ в целом"->"Контрагенты ТЧМ и ТЧМС"->"Направления"->"ПРОЧИЕ СПРАВОЧНИКИ ТЧМ и ТЧМС"->"Центры финансовой ответсвенности"->"ЭЛЕМЕНТЫ ЗАТРАТ ТЧМ И ТЧМС"->"Реализация осн продукции на внутр рынок"->"62_Реализация без НДС"->"бу МВЗ (пол-ль)"->"Сумма"->"RUR"->"Кислород газообразный в баллонах.")
      )/"Кол-во"*"Кол-во"         
      ;
   ENDIF 
    ENDIF
ENDIF
)


set createnonmissingblk off;

ENDFIX

ENDFIX 

ENDFIX]]></script>
    </rule>
  </rules>
  <components></components>
</HBRRepo>