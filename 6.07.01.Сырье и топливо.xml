<?xml version="1.0" encoding="UTF-8"?>
<HBRRepo>
  <variables>
    <variable id="1" name="ГОД" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Year</property>
      <property name="prompt_text">Выберите Год</property>
      <property name="scope">ruleset</property>
      <value>FY18</value>
    </variable>
    <variable id="2" name="ЦФО" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Entity</property>
      <property name="prompt_text">Выберите ЦФО</property>
      <property name="scope">ruleset</property>
      <value>"бу ЦФО"</value>
    </variable>
    <variable id="3" name="ВЕРСИЯ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Version</property>
      <property name="prompt_text">Выберите Версию</property>
      <property name="scope">ruleset</property>
      <value>Рабочая_1</value>
    </variable>
    <variable id="4" name="СЦЕНАРИЙ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Scenario</property>
      <property name="prompt_text">Выберите Сценарий</property>
      <property name="scope">ruleset</property>
      <value>Проект</value>
    </variable>
    <variable id="5" name="МВЗ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">МВЗ</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите МВЗ</property>
      <property name="scope">ruleset</property>
      <value>"Итого по МВЗ"</value>
    </variable>
  </variables>
  <rulesets></rulesets>
  <rules>
    <rule id="1" name="6.07.01.Сырье и топливо" product="Planning">
      <property name="application">ТЧМ</property>
      <property name="plantype">Plan1</property>
      <property name="display_label">6.07.01.Сырье и топливо</property>
      <variable_references>
        <variable_reference id="3" name="ВЕРСИЯ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.07.01.Сырье и топливо</property>
          <property name="seq">1</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="4" name="СЦЕНАРИЙ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.07.01.Сырье и топливо</property>
          <property name="seq">2</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="1" name="ГОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.07.01.Сырье и топливо</property>
          <property name="seq">3</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="5" name="МВЗ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.07.01.Сырье и топливо</property>
          <property name="seq">4</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="2" name="ЦФО">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.07.01.Сырье и топливо</property>
          <property name="seq">5</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
      </variable_references>
      <script><![CDATA[SET AGGMISSG ON;
SET UPDATECALC OFF;
SET CREATEBLOCKONEQ OFF;
SET CREATENONMISSINGBLK OFF;
SET FRMLBOTTOMUP OFF;
SET REMOTECALC OFF;
SET CALCPARALLEL 1;
SET CALCTASKDIMS 1;
SET EMPTYMEMBERSETS ON;
SET FRMLRTDYNAMIC OFF;
SET MSG INFO;
/* Проверка корректности рассчитываемого среза данных */

FIX(
/* ВАЛЮТА							*/	"бу валюты"
/* ПЕРИОД							*/	"P0"
/* ГОД								*/	"No Year"
/* ВЕРСИЯ							*/	
/* СЦЕНАРИЙ							*/	
/* ЦФО								*/	"бу ЦФО"
/* МВЗ								*/	"бу МВЗ"
/* МВЗ ПОЛУЧАТЕЛЬ					*/	"бу МВЗ (пол-ль)"
/* СЧЕТА БАЛАНСА					*/	"80_Увеличение"
/* СТАТЬИ							*/	
/* ПОКАЗАТЕЛИ						*/	"Сумма"
/* ВИД ЗАТРАТ						*/	"бу видов затрат"
/* ПРОДУКЦИЯ						*/	"бу вида продукции"
/* КОНТРАГЕНТЫ						*/	"бу контрагента"
/* НАПРАВЛЕНИЕ	*/	"бу направления"
/* ЭЛЕМЕНТЫ_ЗАТРАТ					*/	"бу элемента затрат"
/* ПРОЧЕЕ							*/	"бу прочих справочников"

)
  SET CREATENONMISSINGBLK ON;

  
  var ErrFlagScenario=0;
  var ErrFlagVersion=0;
  var NextM=2;
  /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА СЦЕНАРИЯ */
  FIX(/* Сценарий */ {СЦЕНАРИЙ} AND @LIST(&ОТКРЫТЫЕ_СЦЕНАРИИ))
    FIX(
    /* Сценарий */ 
    /* Версия   */ "Рабочая 1"
    )
     "бу статьи" (
     IF (ErrFlagScenario==0)
            ErrFlagScenario=1;
     ENDIF
     );

    ENDFIX
  ENDFIX

   /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА ВЕРСИИ */
  FIX(/* Версия  */ {ВЕРСИЯ} AND @LIST(&ОТКРЫТЫЕ_ВЕРСИИ))
    FIX(
    /* Сценарий */ "Проект"
    /* Версия   */ 
    )
     "бу статьи" (
     IF (ErrFlagVersion==0)
            ErrFlagVersion=1;
     ENDIF
     );
    ENDFIX
  ENDFIX

  /* ВЫВОД СООБЩЕНИЙ О НЕКОРРЕКТНОМ СРЕЗЕ */
  FIX(
  /* Сценарий     */ "Проект"
  /* Версия       */ "Рабочая 1"
  )

   "бу статьи" (
    IF (ErrFlagScenario==0)
       @RETURN("Выбран сценарий, закрытый для расчета. Расчет не произведен.",ERROR);
    ENDIF
    IF (ErrFlagVersion==0)
       @RETURN("Выбрана версия, закрытая для расчета. Расчет не произведен.",ERROR);
    ENDIF
    )

   ENDFIX
ENDFIX
SET CREATENONMISSINGBLK OFF;
FIX(
/*МВЗ  									*/@LIST("ТЧМ в целом", "ТЧМС в целом") and @RELATIVE({МВЗ},0)
)

FIX(
/*ПРОЧЕЕ 								*/"бу прочих справочников"
/*ПРОДУКЦИЯ  							*/"бу вида продукции"
/*НАПРАВЛЕНИЕ  							*/"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/"бу элемента затрат"
/*МВЗ ПОЛУЧАТЕЛЬ  						*/"бу МВЗ (пол-ль)"
/*ВАЛЮТА  								*/"RUR"
/*ПЕРИОД  								*/@RELATIVE("Итого год",0)
/*КОНТРАГЕНТЫ  							*/"КМАруда","АО Лебединский ГОК","ПАО Михайловский ГОК","ОАО Стойленский ГОК","Прочие внешние","АО Карельский окатыш","ООО СЧПЗ Трейд","ТОО ГФК","ООО ТД ТМЗ","ООО Металл Сервис",
"ООО Метснаб","КНИ","АО Эльдако","АО Стройматериалы","ООО ХимТрейдинг","ООО Фельс-Известь","ООО Центр Известняк","Кокс","АО Москокс","ЗАО Стройсервис","ООО СПН Зенит","ОАО ВАЗ","АО Энергопром-НЭЗ","ООО ИТЭК",
"ООО Эталон деталь","ООО РДК","ООО УВЗ Ферросплав","ООО ВПО Сталь","ООО СДК","ООО ВорлдЛоджистик","ООО Строй Снаб","АО ННК","ООО НПП ХимПромОборудование","ООО Аврора","ООО ТД Нерудный",
"ООО Балкум","ООО Хайдельбергцемент","ООО ТД ПМЦЗ","бу контрагента"
/*ВЕРСИЯ	  							*/{ВЕРСИЯ}
/*ГОД  									*/{ГОД}
/*МВЗ  									*/
/*СЦЕНАРИЙ  							*/{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ  							*//* Start Template:ТЧМ.Plan1.TPL_ВЗ_6_БЛОК*/
"Концентрат КМА",
"Концентрат ЛГОК",
"Концентрат МГОК",
"Концентрат СГОК",
"Окатыши МГОК",
"Окатыши ЛГОК",
"Окатыши Карельские",
"Руда доменная МГОК",
"Руда доменная КЖРК",
"Руда марганцевая",
"Аглоруда Яковлевская",
"Шлак металлургический",
"Известняк фр. 0-20",
"Известняк фр. 20-40",
"Известняк фр. 40-70",
"Известь со стороны",
"Плавиковый шпат",
"Коксовый орех",
"Коксовая мелочь стор.",
"Газ природный",
"Газ природный (осн. объем)",
"Газ природный (биржа)",
"Цемент ГЦ",
"Портландцемент ЦЕМ I 42,5 H",
"Песок речной",
"Песок формовочный",
"Электроды Uni Cast 4",
"Электроды Uni Cast 3,2",
"Электроды УОНИ 13/45",
"Электроды УОНИ 13/55",
"Электроды МР-3",
"Электроды Т-590",
"Электроды графитовые d150",
"Проволока ПП",
"Проволока Нп-30хГСА",
"Проволока ПП-Нп-35В9х3Сф",
"Проволока ПП-Нп-80х20Р3Т",
"Сварочная проволока СВО8Г2С",
"Проволока МНЖКТ 5-1-0,2-0,2",
"Ферромарганец",
"Ферросилиций",
"Добавка ITP HD-100",
"Добавки ITPHD-100.9-5",
"Добавки КР-50",
"Добавки ezcon kh880",
"Добавка противоморозная ITZ VS-25",
"Щебень шамотный",
"Щебень гранитный",
"Алюминий вторичный",
"Арматура 10A3 (ЦКРО)",
"Арматура 10A1 (ЦКРО)",
"Армосетка",
"Круги + арматура (РМЦ)",
"Бура",
"Вольфрам",
"Углекислота техническая",
"Аргон",
"Прокат.",
"Труба 48х3,5 ст.20",
"Труба 60 ст.3",
"Кварцит",
"Лента порошковая наплавочная",
"Лист медный",
"Лист медный 5 мм",
"Лист медный 5х640х1200",
"Медь фосфористая",
"Металлопрокат (РМЦ)",
"Металлопрокат (ЦРМО)",
"Периглазовый порошок",
"Покрытие цирконовое",
"Порошок",
"Порошок ППМ-85",
"Провод ПЩ",
"Силикат натрия растворимый",
"Сталь нержавеющая",
"Бронза чушковая",
"Термопара",
"Флюс сварочный",
"Электрокорунд",
"Металлоконструкции покупные",
"Пек",
"Экзотерм. Смесь",
"Карб.кремн., смола",
"Кирпич",
"Уголь",
"Глина для глиномялки",
"Графит",
"Лигносульфанат",
"Брикеты содовые",
"Диз. топливо",
"Диз. топливо (ЖДЦ)",
"Бензин в целом",
"Бензин АИ-95",
"Бензин АИ-92",
"Бензин АИ-80",
"Масла и смазки руб.",
"М - 14В2",
"ТП - 22С",
"Электроэнергия покупная",
"Кислота серная техническая",
"Соль техническая",
"Железный купорос",
/*"Гипохлорид натрия",
"Натр едкий технический",
"Бактерицид",
"Ингибитор солеотложений",*/
"Кварцевый песок",
/*"Полиакриламид",
"Реагент PuroTech",
"Удалитель накипно-коррозионных отложений ЛИН",*/
"Фильтр",
"Материалы на ремонт",
"Вспомогательные материалы",
"Инструмент",
"Песок шамотный",
"Инвентарь",
"Тара и тарные материалы",
"Запчасти",
"Прочие материалы",
"Водород",
"ТО силами подрядчиков",
"Аренда тепловоза",
"Весоповерочный вагон",
"Предоставление локомотивных бригад",
"Ремонт вагонов",
"Техническое обслуживание",
"Контрольно-инструкторские поездки",
"Экспертиза промышленной безопасности",
"Реагентная обработка воды",
"Прочие услуги пром.характера",
"Сменный инструмент",
"Сменное оборудование",
"Спецодежда",
"Долом фр. 0-40",
"Долом фр. 40-60(70)",
"Доломит.",
"Феррохром",
"Кокс влажный металлургический",
"Техническое обслуживание газовых сетей",
"Вода",
"Стоки",
"Чугун передельный жидкий ЧП1",
"Чугун чушковый",
"Заготовка стальная покупная",
"Металлом покупной",
"Металлом покупной легированный",
"Материал шихтовый МШ 50",
"Материал шихтовый МШ 250",
"Материал шихтовый МШ 1500",
"Синтиком",
"Ферросиликомарганец_FeSiMn17",
"Ферромарганец кусковой_FeMn88",
"Марганец металлический",
"Карбид кремния",
"Алюминий для раскисления.",
"Проволока алюминиевая",
"Проволока порошковая феррокальциевая",
"Проволока порошковая силикокальциевая_СК30",
"Алюминий для раскисления вторичный.",
"Ферросера",
"Проволока порошковая с ванадием",
"Проволока порошковая с ниобием",
"Порошковая проволока ферромолибден",
"Проволока порошковая с титаном",
"Порошковая проволока ферробор",
"Феррованадий",
"Флюсы обожжённые магнезиальные",
"Теплоизолирующая смесь для стальковша",
"Углеродсодержащий материал",
"Углеродосод. материал МУ-90",
"ЗФС, SiC (карбид кремния)",
"Теплоизолирующая смесь для стальковша_GLUTIN RS-6",
"Теплоизолирующая смесь для стальковша_GLUTIN RS-10",
"Стаканы дозаторы",
"Шлакообразующая смесь для промковша",
"Кристаллизаторы",
"Проволока углеродная",
"Смазка стенок кристализатора",
"Шлакообразующая смесь для промковша_SPH-B795",
"Шлакообразующая смесь для кристаллизатора",
"Коксовая мелочь_",
"Кокс влажный скиповой",
"Огнеупоры (конвертер) Арматурный слой",
"Огнеупоры (конвертер) Рабочий слой",
"Огнеупоры (Чугунозаливочный ковш) Арматурный слой",
"Огнеупоры (Сталеразливочный ковш) Рабочий слой",
"Огнеупоры (Сталеразливочный ковш) Арматурный слой",
"Огнеупоры (Промежуточный ковш) Рабочий слой",
"Огнеупоры (Промежуточный ковш) Арматурный слой",
"Огнеупоры (ТО Сталеразливочного ковша)",
"Огнеупоры (ТО Конвертера) кирпич",
"Огнеупоры (ТО Конвертера) масса",
"Огнеупоры прочие",
"Кислород технологический",
"Пар покупной",
"Питьевая вода",
"Материалы для упаковки проката",
"Материалы для маркировки проката",
"Чугунные валки",
"Твердосплавные валки",
"Привалковая арматура",
"Внутренние элементы трасс термоупрочнения",
"Валки и прижимные ролики роликоправильной машины",
"Ножи для ножниц",
"Пилы",
"Ремонт силами подрядчиков",
"Перепродажа услуг и ТМЦ",
"Чугун передельный жидкий ЧП2",
"Чугун передельный жидкий ПЛ1",
"Чугун передельный жидкий П2",
"Ферросиликомарганец_FeSiMn23",
"Проволока порошковая с углеродом_фр.15мм",
"Феррохром_FeCr70C40",
"Аргон.",
"Азот газообразный",
"Техническая вода",
"Проволока порошковая силикокальциевая_СК40",
"Феррохром_FeCr50С10LP",
"Карбид кальция",
"Ферромарганец кусковой_FeMn78",
"Смеси для засыпки сталевыпускного канала промковша",
"Смесь для засыпки сталевыпускного канала СК.",
"Известь для сталеплавильного производства",
"Шлакообразующая смесь для промковша_B789/BC",
"Боксит",
"Магнезиальный флюс (Брусит)",
"Железная руда кусковая",
"Алюмотермический флюс",
"Уголь АС",
"Проволока порошковая с углеродом_фр.13мм",
"Проволока порошковая с углеродом_фр.15мм",
"Добавки ezcon kh880",
"Коксовый орех_",
"Кокс влажный металлургический_",
"Добавки КР-50",
"Добавки КР-40",
"Перекачка хозбытовых стоков",
"Литники стальные (габаритные)",
"Литники чугунные (габаритные)",
"Лом бронзовый (РМЦ)",
"Водород",
"Аренда оборудования",
"Известняк фр. 5-20",
"Электроды графитированные ф.300",
"Вкладыш графитовый",
"Полимер ТФ-М",
"Оборотный лом чугунный.",
"Оборотный лом стальной."/* End Template:ТЧМ.Plan1.TPL_ВЗ_6_БЛОК*/

/*удалить @Relative("Сырье и основные материалы", 0),@Relative("Услуги и вспомогательные материалы", 0)*/
/*ЦФО  									*/@RELATIVE({ЦФО},0) and  @LIST("ОСиТ","Отдел снабжения","Коммерческая служба", "ПЭО")
/*СТАТЬИ  								*/"Сырье.", "Топливо.","Материалы на технологические цели.","Прочие затраты на содержание","Сменный инструмент и оборудование"
/*ПОКАЗАТЕЛИ  							*/
/*СЧЕТА БАЛАНСА  						*/
)

	

FIX(
/*ПОКАЗАТЕЛИ  							*/ "Кол-во", "Цена", "Тариф внеш.", "Сумма"
)



DATACOPY "10_Закупка" TO "60_Начисление без НДС";

"60_Начисление без НДС"(
"60_Начисление без НДС"=#missing;
"60_Начисление без НДС"->"Кол-во" = "10_Закупка"->"Кол-во";
"60_Начисление без НДС"->"Цена" = "10_Закупка"->"Цена";
"60_Начисление без НДС"->"Тариф внеш."= "10_Закупка"->"Тариф внеш.";
"60_Начисление без НДС"->"Сумма" = "60_Начисление без НДС"->"Кол-во"*("10_Закупка"->"Цена"+"10_Закупка"->"Тариф внеш.") ;

)

ENDFIX



FIX(
/*ПОКАЗАТЕЛИ  							*/ "Сумма"
)


DATACOPY "60_Начисление без НДС" to "60_Начисление с НДС";




"60_Начисление с НДС"=#missing;
"60_Начисление с НДС"(
"60_Начисление с НДС" = "60_Начисление без НДС" *((100+"бу счета баланса"->"Рабочая 1"->"Ставка НДС, %"->"P0"->"бу МВЗ"->"бу ЦФО"->"бу элемента затрат"->"бу контрагента"->"RUR")/100);
)

/*

DATACOPY "60_ДЗ/КЗ на начало (+/-)" to "60_Окон.расчет до корректировки";

DATACOPY "60_Окон.расчет до корректировки" to "60_Окончат расчет";
DATACOPY "60_Корректировка оплат" to "60_Окончат расчет";


"60_Окон.расчет до корректировки"=#missing;
"60_Окон.расчет до корректировки"(
IF(@ISMBR("Январь"))
-"60_ДЗ/КЗ на начало (+/-)";
ELSEIF (@ISMBR("Февраль":"Декабрь") )
 -@PRIOR("60_ДЗ/КЗ на конец (+/-)");  
ENDIF
)

"60_Окончат расчет"=#missing;
"60_Окончат расчет"(
"60_Окон.расчет до корректировки"+"60_Корректировка оплат";
)

*/




SET CREATENONMISSINGBLK ON;

"60_ДЗ/КЗ на конец (+/-)"=#missing;
"60_ДЗ/КЗ на конец (+/-)"(
IF(@ISMBR("Январь"))
"60_ДЗ/КЗ на начало (+/-)"-"60_Начисление с НДС"+"60_Оплата аванса"+"60_Окончат расчет";
ELSEIF (@ISMBR("Февраль":"Декабрь"))
@PRIOR("60_ДЗ/КЗ на конец (+/-)")-"60_Начисление с НДС"+"60_Оплата аванса"+"60_Окончат расчет" ;
ENDIF
)


"60_ДЗ/КЗ на начало (+/-)"(
IF( @ISMBR("Февраль":"Декабрь") )
"60_ДЗ/КЗ на начало (+/-)"=#missing;
@PRIOR("60_ДЗ/КЗ на конец (+/-)");
ENDIF
)

SET CREATENONMISSINGBLK OFF;

CLEARBLOCK EMPTY;


ENDFIX

ENDFIX
ENDFIX]]></script>
    </rule>
  </rules>
  <components></components>
</HBRRepo>