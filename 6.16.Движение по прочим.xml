<?xml version="1.0" encoding="UTF-8"?>
<HBRRepo>
  <variables>
    <variable id="1" name="ГОД" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Year</property>
      <property name="prompt_text">Выберите Год</property>
      <property name="scope">ruleset</property>
      <value>FY18</value>
    </variable>
    <variable id="2" name="ЦФО" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Entity</property>
      <property name="prompt_text">Выберите ЦФО</property>
      <property name="scope">ruleset</property>
      <value>"бу ЦФО"</value>
    </variable>
    <variable id="3" name="ВЕРСИЯ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Version</property>
      <property name="prompt_text">Выберите Версию</property>
      <property name="scope">ruleset</property>
      <value>Рабочая_1</value>
    </variable>
    <variable id="4" name="СЦЕНАРИЙ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimensionInputMode">type</property>
      <property name="dimensionType">Scenario</property>
      <property name="prompt_text">Выберите Сценарий</property>
      <property name="scope">ruleset</property>
      <value>Проект</value>
    </variable>
    <variable id="5" name="МВЗ" product="Planning" type="member" usage="const">
      <property name="array_type">string</property>
      <property name="dimension">МВЗ</property>
      <property name="dimensionInputMode">name</property>
      <property name="prompt_text">Выберите МВЗ</property>
      <property name="scope">ruleset</property>
      <value>"Итого по МВЗ"</value>
    </variable>
  </variables>
  <rulesets></rulesets>
  <rules>
    <rule id="1" name="6.16.Движение по прочим" product="Planning">
      <property name="application">ТЧМ</property>
      <property name="plantype">Plan1</property>
      <property name="display_label">6.16.Движение по прочим</property>
      <variable_references>
        <variable_reference id="3" name="ВЕРСИЯ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.16.Движение по прочим</property>
          <property name="seq">1</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="4" name="СЦЕНАРИЙ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.16.Движение по прочим</property>
          <property name="seq">2</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="1" name="ГОД">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.16.Движение по прочим</property>
          <property name="seq">3</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="5" name="МВЗ">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.16.Движение по прочим</property>
          <property name="seq">4</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
        <variable_reference id="2" name="ЦФО">
          <property name="hasvalue">true</property>
          <property name="hidden">false</property>
          <property name="rule_name">6.16.Движение по прочим</property>
          <property name="seq">5</property>
          <property name="type">3</property>
          <property name="useAsOverrideValue">false</property>
        </variable_reference>
      </variable_references>
      <script><![CDATA[SET AGGMISSG ON;
SET UPDATECALC OFF;
SET CREATEBLOCKONEQ OFF;
SET CREATENONMISSINGBLK OFF;
SET FRMLBOTTOMUP OFF;
SET REMOTECALC OFF;
SET CALCPARALLEL 1;
SET CALCTASKDIMS 1;
SET EMPTYMEMBERSETS ON;
SET FRMLRTDYNAMIC OFF;
SET MSG INFO;
/* Проверка корректности рассчитываемого среза данных */

FIX(
/* ВАЛЮТА							*/	"бу валюты"
/* ПЕРИОД							*/	"P0"
/* ГОД								*/	"No Year"
/* ВЕРСИЯ							*/	
/* СЦЕНАРИЙ							*/	
/* ЦФО								*/	"бу ЦФО"
/* МВЗ								*/	"бу МВЗ"
/* МВЗ ПОЛУЧАТЕЛЬ					*/	"бу МВЗ (пол-ль)"
/* СЧЕТА БАЛАНСА					*/	"80_Увеличение"
/* СТАТЬИ							*/	
/* ПОКАЗАТЕЛИ						*/	"Сумма"
/* ВИД ЗАТРАТ						*/	"бу видов затрат"
/* ПРОДУКЦИЯ						*/	"бу вида продукции"
/* КОНТРАГЕНТЫ						*/	"бу контрагента"
/* НАПРАВЛЕНИЕ	*/	"бу направления"
/* ЭЛЕМЕНТЫ_ЗАТРАТ					*/	"бу элемента затрат"
/* ПРОЧЕЕ							*/	"бу прочих справочников"

)
  SET CREATENONMISSINGBLK ON;

  
  var ErrFlagScenario=0;
  var ErrFlagVersion=0;
  var NextM=2;
  /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА СЦЕНАРИЯ */
  FIX(/* Сценарий */ {СЦЕНАРИЙ} AND @LIST(&ОТКРЫТЫЕ_СЦЕНАРИИ))
    FIX(
    /* Сценарий */ 
    /* Версия   */ "Рабочая 1"
    )
     "бу статьи" (
     IF (ErrFlagScenario==0)
            ErrFlagScenario=1;
     ENDIF
     );

    ENDFIX
  ENDFIX

   /* ПРОВЕРКА КОРРЕКТНОСТИ ВЫБОРА ВЕРСИИ */
  FIX(/* Версия  */ {ВЕРСИЯ} AND @LIST(&ОТКРЫТЫЕ_ВЕРСИИ))
    FIX(
    /* Сценарий */ "Проект"
    /* Версия   */ 
    )
     "бу статьи" (
     IF (ErrFlagVersion==0)
            ErrFlagVersion=1;
     ENDIF
     );
    ENDFIX
  ENDFIX

  /* ВЫВОД СООБЩЕНИЙ О НЕКОРРЕКТНОМ СРЕЗЕ */
  FIX(
  /* Сценарий     */ "Проект"
  /* Версия       */ "Рабочая 1"
  )

   "бу статьи" (
    IF (ErrFlagScenario==0)
       @RETURN("Выбран сценарий, закрытый для расчета. Расчет не произведен.",ERROR);
    ENDIF
    IF (ErrFlagVersion==0)
       @RETURN("Выбрана версия, закрытая для расчета. Расчет не произведен.",ERROR);
    ENDIF
    )

   ENDFIX
ENDFIX
SET CREATENONMISSINGBLK OFF;
FIX(
/*МВЗ  									*/@LIST("ТЧМ в целом", "ТЧМС в целом") and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОЧЕЕ 								*/"бу прочих справочников"
/*ПРОДУКЦИЯ  							*/"бу вида продукции"
/*НАПРАВЛЕНИЕ  							*/"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ  						*/"бу элемента затрат"
/*МВЗ ПОЛУЧАТЕЛЬ  						*/"бу МВЗ (пол-ль)"
/*ВАЛЮТА  								*/"RUR"
/*ПЕРИОД  								*/@RELATIVE("Итого год",0)
/*ВЕРСИЯ	  							*/{ВЕРСИЯ}
/*ГОД  									*/{ГОД}
/*МВЗ  									*/
/*СЦЕНАРИЙ  							*/{СЦЕНАРИЙ}
/*ЦФО  									*/@RELATIVE({ЦФО},0) and  @LIST("ПЭО","Коммерческая служба")
/*ПОКАЗАТЕЛИ  							*/"Кол-во","Сумма"
/*СЧЕТА БАЛАНСА  						*/"10_Закупка"
											"10_Списание"
                                          "10_Закупка до кор-ки"
                                          "10_Остаток на конец"
                                          "60_Начисление без НДС"
                                          "60_Начисление с НДС"
                                          "60_ДЗ/КЗ на конец (+/-)"
                                          "60_Окончат расчет"
                                          "60_Окончат расчет до корректировки"

/*СТАТЬИ  								*/"Прочие затраты на содержание"
/*ВИД ЗАТРАТ  							*/@LIST(@RDESCENDANTS("Материалы на содержание:"),@RDESCENDANTS("Прочие материалы на содержание:")) AND @RELATIVE("Всего по видам затрат",0)
/*КОНТРАГЕНТЫ  							*/"бу контрагента"
)

CLEARBLOCK ALL;
ENDFIX
ENDFIX
/*Агрегируем Срез Смметы для переноса*/
FIX(
/*МВЗ                         */@ILDESCENDANTS(@LIST(@IANCESTORS({МВЗ},4),"бу МВЗ")) and  @RELATIVE("Всего по МВЗ",0)
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ЦФО                            */"ПЭО"
/*КОНТРАГЕНТЫ                    */"бу контрагента"
/*НАПРАВЛЕНИЯ СПИСАНИЯ_ОТГРУЗКИ     */"бу направления"
/*ПРОЧЕЕ                       */"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */@RELATIVE("Начисление",0)
/*МВЗ ПОЛУЧАТЕЛЬ                 */   
/*ВАЛЮТА                        */"RUR"
/*ВИД ЗАТРАТ                     */@RDESCENDANTS("Материалы на содержание:"),@RDESCENDANTS("Прочие материалы на содержание:") AND @RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ                       */
/*СЦЕНАРИЙ                       */{СЦЕНАРИЙ}
/*ПЕРИОД                         */@RELATIVE("Итого год",0)
/*ВЕРСИЯ                          */{ВЕРСИЯ}
/*ГОД                              */{ГОД}
/*ПРОДУКЦИЯ                       */
/*ПОКАЗАТЕЛИ                        */"Кол-во"

)
FIXPARALLEL(8,@DESCENDANTS("ПОЛНАЯ СЕБЕСТОИМОСТЬ"))
/*арешируем только всего по продукции*/
FIX(
/*ПРОДУКЦИЯ                  */@RELATIVE("Всего по продукции",0)
)
AGG("МВЗ ПОЛУЧАТЕЛЬ");
ENDFIX

FIX(
/*ПРОДУКЦИЯ                  */"МВЗ получатели"
)
AGG("ПРОДУКЦИЯ");
ENDFIX

ENDFIXPARALLEL

ENDFIX


/*Срез Смметы для переноса*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ЦФО                            */"ПЭО"
/*КОНТРАГЕНТЫ                    */"бу контрагента"
/*НАПРАВЛЕНИЯ СПИСАНИЯ_ОТГРУЗКИ     */"бу направления"
/*ПРОЧЕЕ                       */
/*СЧЕТА БАЛАНСА                      */@RELATIVE("Начисление",0)
/*МВЗ ПОЛУЧАТЕЛЬ                 */  "МВЗ получатели"
/*ВАЛЮТА                        */"RUR"
/*ВИД ЗАТРАТ                     */@LIST(@DESCENDANTS("Материалы на содержание:"),@DESCENDANTS("Прочие материалы на содержание:")) AND @RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ                       	*/
/*СЦЕНАРИЙ                       */{СЦЕНАРИЙ}
/*ПЕРИОД                         */@RELATIVE("Итого год",0)
/*ВЕРСИЯ                          */{ВЕРСИЯ}
/*ГОД                              */{ГОД}
/*ПРОДУКЦИЯ                       */"ПРОДУКЦИЯ ТЧМ и ТЧМС" 
/*ПОКАЗАТЕЛИ                        */"Кол-во"
/*МВЗ                             */@ILDESCENDANTS(@LIST(@IANCESTORS({МВЗ},4),"бу МВЗ")) and  @RELATIVE("Всего по МВЗ",0)
)

FIXPARALLEL(8,@DESCENDANTS("ПОЛНАЯ СЕБЕСТОИМОСТЬ"))
"бу прочих справочников"(
@CALCMODE(CELL);
IF("бу прочих справочников"+0<>0 )

IF("Статья ФП" ==11 )/*Cтатя ФП Прочие затраты на содержание */
IF(@ISDESC("ТЧМ Итого"))
"бу прочих справочников"->"бу МВЗ (пол-ль)"->
/*получаем из продукции ПП -> ВЗ калькуляции */
/*получаем из "бу статьи" и ВЗ -> Cтатью ФП */
"Прочие затраты на содержание"->
/*подменяем МВЗ МВЗ источника */
{МВЗ}->
/*подменяем цфо*/
@MEMBER(@PerForScen(@NAME(@CURRMBR("ВИД ЗАТРАТ")),/* Start Template:ТЧМ.Plan1.TPL_ЦФОВЗ*/
"Концентрат КМА|ОСиТ|Концентрат ЛГОК|ОСиТ|Концентрат МГОК|ОСиТ|Концентрат СГОК|ОСиТ|Окатыши МГОК|ОСиТ|Окатыши ЛГОК|ОСиТ|Окатыши Карельские|ОСиТ|Руда доменная МГОК|ОСиТ|Руда доменная КЖРК|ОСиТ|Руда марганцевая|ОСиТ|Аглоруда Яковлевская|ОСиТ|Шлак металлургический|ОСиТ|Известняк фр. 0-20|ОСиТ|Известняк фр. 20-40|ОСиТ|Известняк фр. 40-70|ОСиТ|Известь со стороны|ОСиТ|Плавиковый шпат|ОСиТ|Карбид кремния|ОСиТ|Коксовый орех|ОСиТ|Коксовая мелочь стор.|ОСиТ|Газ природный|ОСиТ|Газ природный (осн. объем)|ОСиТ|Газ природный (биржа)|ОСиТ|Цемент ГЦ|ОСиТ|Портландцемент ЦЕМ I 42,5 H|ОСиТ|Песок речной|ОСиТ|Песок формовочный|ОСиТ|Электроды Uni Cast 4|ПЭО|Электроды Uni Cast 3,2|ПЭО|Электроды УОНИ 13/45|ПЭО|Электроды УОНИ 13/55|ПЭО|Электроды МР-3|ПЭО|Электроды Т-590|ПЭО|Электроды графитовые d150|ОСиТ|Проволока ПП|ОСиТ|Проволока Нп-30хГСА|ПЭО|Проволока ПП-Нп-35В9х3Сф|ПЭО|Проволока ПП-Нп-80х20Р3Т|ПЭО|Сварочная проволока СВО8Г2С|ПЭО|Проволока МНЖКТ 5-1-0,2-0,2|ПЭО|Ферромарганец|ОСиТ|Ферросилиций|ОСиТ|Добавка ITP HD-100|Отдел снабжения|Добавки ITPHD-100.9-5|Отдел снабжения|Добавка противоморозная ITZ VS-25|Отдел снабжения|Добавки ezcon kh880|Отдел снабжения|Добавки КР-50|Отдел снабжения|Щебень шамотный|Отдел снабжения|Щебень гранитный|ОСиТ|Алюминий вторичный|ПЭО|Арматура 10A3 (ЦКРО)|ПЭО|Арматура 10A1 (ЦКРО)|ПЭО|Армосетка|ПЭО|Круги + арматура (РМЦ)|ПЭО|Бура|ПЭО|Вольфрам|ПЭО|Углекислота техническая|ПЭО|Аргон|Отдел снабжения|Прокат.|ПЭО|Труба 48х3,5 ст.20|ПЭО|Труба 60 ст.3|ПЭО|Кварцит|ПЭО|Лента порошковая наплавочная|ПЭО|Лист медный|ПЭО|Лист медный 5 мм|ПЭО|Лист медный 5х640х1200|ПЭО|Медь фосфористая|ПЭО|Металлопрокат (РМЦ)|ПЭО|Металлопрокат (ЦРМО)|ПЭО|Периглазовый порошок|ПЭО|Покрытие цирконовое|ПЭО|Порошок|ПЭО|Порошок ППМ-85|ПЭО|Провод ПЩ|ПЭО|Силикат натрия растворимый|ОСиТ|Сталь нержавеющая|ПЭО|Бронза чушковая|ПЭО|Термопара|ПЭО|Флюс сварочный|ПЭО|Электрокорунд|ОСиТ|Металлоконструкции покупные|ПЭО|Пек|ПЭО|Экзотерм. Смесь|ПЭО|Карб.кремн., смола|ПЭО|Кирпич|ПЭО|Уголь|ПЭО|Глина для глиномялки|ПЭО|Графит|ОСиТ|Лигносульфанат|ОСиТ|Брикеты содовые|ОСиТ|Диз. топливо|Отдел снабжения|Бензин в целом|Отдел снабжения|Бензин АИ-95|Отдел снабжения|Бензин АИ-92|Отдел снабжения|Бензин АИ-80|Отдел снабжения|Масла и смазки руб.|Отдел снабжения|М - 14В2|Отдел снабжения|ТП - 22С|Отдел снабжения|Электроэнергия покупная|Упр по реал-ции прод-ции|Кислота серная техническая|ПЭО|Соль техническая|ПЭО|Железный купорос|ПЭО|Гипохлорид натрия|ПЭО|Натр едкий технический|ПЭО|Бактерицид|ПЭО|Ингибитор солеотложений|ПЭО|Кварцевый песок|ОСиТ|Полиакриламид|ПЭО|Реагент PuroTech|ПЭО|Удалитель накипно-коррозионных отложений ЛИН|ПЭО|Фильтр|ПЭО|Материалы на ремонт|ПЭО|Вспомогательные материалы|ПЭО|Инструмент|ПЭО|Песок шамотный|Отдел снабжения|Инвентарь|ПЭО|Тара и тарные материалы|ПЭО|Запчасти|ПЭО|Прочие материалы|ПЭО|Водород в баллонах|ПЭО|ТО силами подрядчиков|ПЭО|Аренда тепловоза|ПЭО|Весоповерочный вагон|ПЭО|Предоставление локомотивных бригад|ПЭО|Ремонт вагонов|ПЭО|Техническое обслуживание|ПЭО|Контрольно-инструкторские поездки|ПЭО|Экспертиза промышленной безопасности|ПЭО|Реагентная обработка воды|ПЭО|Прочие услуги пром.характера|ПЭО|Сменный инструмент|ПЭО|Сменное оборудование|ПЭО|Спецодежда|ПЭО|Долом фр. 0-40|ОСиТ|Долом фр. 40-60(70)|ОСиТ|Доломит.|ОСиТ|Феррохром|ОСиТ|Кокс влажный металлургический|ОСиТ|Техническое обслуживание газовых сетей|Упр по реал-ции прод-ции|Вода|Упр по реал-ции прод-ции|Стоки|Упр по реал-ции прод-ции|Диз. топливо (ЖДЦ)|Отдел снабжения|Добавки КР-40|ПЭО|Перекачка хозбытовых стоков|Коммерческая служба|Литники стальные (габаритные)|ПЭО|Литники чугунные (габаритные)|ПЭО|Лом бронзовый (РМЦ)|ПЭО|Водород|Упр по реал-ции прод-ции|Аренда оборудования|Упр по реал-ции прод-ции|Техническое обслуживание|Упр по реал-ции прод-ции|Известняк фр. 5-20|ОСиТ|Электроды графитированные ф.300|ОСиТ|Вкладыш графитовый|ОСиТ|Полимер ТФ-М|ОСиТ|Стоки|Коммерческая служба"/* End Template:ТЧМ.Plan1.TPL_ЦФОВЗ*/
))->
"бу вида продукции"->"бу направления"->"10_Списание"
 = 
"бу прочих справочников"->"бу МВЗ (пол-ль)"->
/*получаем из продукции ПП -> ВЗ калькуляции */
/*получаем из ВЗ -> Cтатью ФП */
"Прочие затраты на содержание"->
/*подменяем МВЗ МВЗ источника */
{МВЗ}->
/*подменяем цфо*/
@MEMBER(@PerForScen(@NAME(@CURRMBR("ВИД ЗАТРАТ")),/* Start Template:ТЧМ.Plan1.TPL_ЦФОВЗ*/
"Концентрат КМА|ОСиТ|Концентрат ЛГОК|ОСиТ|Концентрат МГОК|ОСиТ|Концентрат СГОК|ОСиТ|Окатыши МГОК|ОСиТ|Окатыши ЛГОК|ОСиТ|Окатыши Карельские|ОСиТ|Руда доменная МГОК|ОСиТ|Руда доменная КЖРК|ОСиТ|Руда марганцевая|ОСиТ|Аглоруда Яковлевская|ОСиТ|Шлак металлургический|ОСиТ|Известняк фр. 0-20|ОСиТ|Известняк фр. 20-40|ОСиТ|Известняк фр. 40-70|ОСиТ|Известь со стороны|ОСиТ|Плавиковый шпат|ОСиТ|Карбид кремния|ОСиТ|Коксовый орех|ОСиТ|Коксовая мелочь стор.|ОСиТ|Газ природный|ОСиТ|Газ природный (осн. объем)|ОСиТ|Газ природный (биржа)|ОСиТ|Цемент ГЦ|ОСиТ|Портландцемент ЦЕМ I 42,5 H|ОСиТ|Песок речной|ОСиТ|Песок формовочный|ОСиТ|Электроды Uni Cast 4|ПЭО|Электроды Uni Cast 3,2|ПЭО|Электроды УОНИ 13/45|ПЭО|Электроды УОНИ 13/55|ПЭО|Электроды МР-3|ПЭО|Электроды Т-590|ПЭО|Электроды графитовые d150|ОСиТ|Проволока ПП|ОСиТ|Проволока Нп-30хГСА|ПЭО|Проволока ПП-Нп-35В9х3Сф|ПЭО|Проволока ПП-Нп-80х20Р3Т|ПЭО|Сварочная проволока СВО8Г2С|ПЭО|Проволока МНЖКТ 5-1-0,2-0,2|ПЭО|Ферромарганец|ОСиТ|Ферросилиций|ОСиТ|Добавка ITP HD-100|Отдел снабжения|Добавки ITPHD-100.9-5|Отдел снабжения|Добавка противоморозная ITZ VS-25|Отдел снабжения|Добавки ezcon kh880|Отдел снабжения|Добавки КР-50|Отдел снабжения|Щебень шамотный|Отдел снабжения|Щебень гранитный|ОСиТ|Алюминий вторичный|ПЭО|Арматура 10A3 (ЦКРО)|ПЭО|Арматура 10A1 (ЦКРО)|ПЭО|Армосетка|ПЭО|Круги + арматура (РМЦ)|ПЭО|Бура|ПЭО|Вольфрам|ПЭО|Углекислота техническая|ПЭО|Аргон|Отдел снабжения|Прокат.|ПЭО|Труба 48х3,5 ст.20|ПЭО|Труба 60 ст.3|ПЭО|Кварцит|ПЭО|Лента порошковая наплавочная|ПЭО|Лист медный|ПЭО|Лист медный 5 мм|ПЭО|Лист медный 5х640х1200|ПЭО|Медь фосфористая|ПЭО|Металлопрокат (РМЦ)|ПЭО|Металлопрокат (ЦРМО)|ПЭО|Периглазовый порошок|ПЭО|Покрытие цирконовое|ПЭО|Порошок|ПЭО|Порошок ППМ-85|ПЭО|Провод ПЩ|ПЭО|Силикат натрия растворимый|ОСиТ|Сталь нержавеющая|ПЭО|Бронза чушковая|ПЭО|Термопара|ПЭО|Флюс сварочный|ПЭО|Электрокорунд|ОСиТ|Металлоконструкции покупные|ПЭО|Пек|ПЭО|Экзотерм. Смесь|ПЭО|Карб.кремн., смола|ПЭО|Кирпич|ПЭО|Уголь|ПЭО|Глина для глиномялки|ПЭО|Графит|ОСиТ|Лигносульфанат|ОСиТ|Брикеты содовые|ОСиТ|Диз. топливо|Отдел снабжения|Бензин в целом|Отдел снабжения|Бензин АИ-95|Отдел снабжения|Бензин АИ-92|Отдел снабжения|Бензин АИ-80|Отдел снабжения|Масла и смазки руб.|Отдел снабжения|М - 14В2|Отдел снабжения|ТП - 22С|Отдел снабжения|Электроэнергия покупная|Упр по реал-ции прод-ции|Кислота серная техническая|ПЭО|Соль техническая|ПЭО|Железный купорос|ПЭО|Гипохлорид натрия|ПЭО|Натр едкий технический|ПЭО|Бактерицид|ПЭО|Ингибитор солеотложений|ПЭО|Кварцевый песок|ОСиТ|Полиакриламид|ПЭО|Реагент PuroTech|ПЭО|Удалитель накипно-коррозионных отложений ЛИН|ПЭО|Фильтр|ПЭО|Материалы на ремонт|ПЭО|Вспомогательные материалы|ПЭО|Инструмент|ПЭО|Песок шамотный|Отдел снабжения|Инвентарь|ПЭО|Тара и тарные материалы|ПЭО|Запчасти|ПЭО|Прочие материалы|ПЭО|Водород в баллонах|ПЭО|ТО силами подрядчиков|ПЭО|Аренда тепловоза|ПЭО|Весоповерочный вагон|ПЭО|Предоставление локомотивных бригад|ПЭО|Ремонт вагонов|ПЭО|Техническое обслуживание|ПЭО|Контрольно-инструкторские поездки|ПЭО|Экспертиза промышленной безопасности|ПЭО|Реагентная обработка воды|ПЭО|Прочие услуги пром.характера|ПЭО|Сменный инструмент|ПЭО|Сменное оборудование|ПЭО|Спецодежда|ПЭО|Долом фр. 0-40|ОСиТ|Долом фр. 40-60(70)|ОСиТ|Доломит.|ОСиТ|Феррохром|ОСиТ|Кокс влажный металлургический|ОСиТ|Техническое обслуживание газовых сетей|Упр по реал-ции прод-ции|Вода|Упр по реал-ции прод-ции|Стоки|Упр по реал-ции прод-ции|Диз. топливо (ЖДЦ)|Отдел снабжения|Добавки КР-40|ПЭО|Перекачка хозбытовых стоков|Коммерческая служба|Литники стальные (габаритные)|ПЭО|Литники чугунные (габаритные)|ПЭО|Лом бронзовый (РМЦ)|ПЭО|Водород|Упр по реал-ции прод-ции|Аренда оборудования|Упр по реал-ции прод-ции|Техническое обслуживание|Упр по реал-ции прод-ции|Известняк фр. 5-20|ОСиТ|Электроды графитированные ф.300|ОСиТ|Вкладыш графитовый|ОСиТ|Полимер ТФ-М|ОСиТ|Стоки|Коммерческая служба"/* End Template:ТЧМ.Plan1.TPL_ЦФОВЗ*/
))->
"бу вида продукции"->"бу направления"->"10_Списание"
 + "бу прочих справочников"->"ПОЛНАЯ СЕБЕСТОИМОСТЬ"; /*переносим на целевой срез с накоплением*/
/*ELSE
@RETURN(@CONCATENATE(@CONCATENATE("Данный ВЗ: ", @NAME(@CURRMBR("ВИД ЗАТРАТ")))," не разрешен в Мэпингом ВЗ ЦФО для ТЧМ. Исправьте шаблон TPL_ЦФОВЗ, а так же формулу элемента Мэпинг ВЗ м ЦФО"),ERROR);

ENDIF
*/
ELSE /*для ТЧМС*/
 "бу прочих справочников"->"бу МВЗ (пол-ль)"->
/*получаем из продукции ПП -> ВЗ калькуляции */
/*получаем из "бу статьи" и ВЗ -> Cтатью ФП */
"Прочие затраты на содержание"->
/*подменяем МВЗ МВЗ источника */
{МВЗ}->
/*подменяем цфо*/
"Коммерческая служба"->
"бу вида продукции"->"бу направления"->"10_Списание"
 = 
"бу прочих справочников"->"бу МВЗ (пол-ль)"->
/*получаем из продукции ПП -> ВЗ калькуляции */
/*получаем из ВЗ -> Cтатью ФП */
"Прочие затраты на содержание"->
/*подменяем МВЗ МВЗ источника */
{МВЗ}->
/*подменяем цфо*/
"Коммерческая служба"->
"бу вида продукции"->"бу направления"->"10_Списание"
 + "бу прочих справочников"->"ПОЛНАЯ СЕБЕСТОИМОСТЬ"; /*переносим на целевой срез с накоплением*/
ENDIF
 
ENDIF

ENDIF
)
ENDFIXPARALLEL
ENDFIX 



/*Удаляем лишний агрегат Смметы для переноса*/
FIX(
/*ЭЛЕМЕНТЫ_ЗАТРАТ                */"бу элемента затрат"
/*ЦФО                            */"ПЭО"
/*КОНТРАГЕНТЫ                    */"бу контрагента"
/*НАПРАВЛЕНИЯ СПИСАНИЯ_ОТГРУЗКИ     */"бу направления"
/*ПРОЧЕЕ                       		*/"бу прочих справочников"
/*СЧЕТА БАЛАНСА                      */@RELATIVE("Начисление",0)
/*МВЗ ПОЛУЧАТЕЛЬ                 */    "МВЗ получатели"
/*ВАЛЮТА                        */"RUR"
/*ВИД ЗАТРАТ                     */@RDESCENDANTS("Материалы на содержание:") AND @RELATIVE("Всего по видам затрат",0)
/*СТАТЬИ                       */
/*СЦЕНАРИЙ                       */{СЦЕНАРИЙ}
/*ПЕРИОД                         */@RELATIVE("Итого год",0)
/*ВЕРСИЯ                          */{ВЕРСИЯ}
/*ГОД                              */{ГОД}
/*ПРОДУКЦИЯ                       */@RELATIVE("Всего по продукции",0),"ПРОДУКЦИЯ ТЧМ и ТЧМС"  
/*ПОКАЗАТЕЛИ                        */"Сумма"
/*МВЗ                             */@ILDESCENDANTS(@LIST(@ANCESTORS({МВЗ},4),"бу МВЗ")) and  @RELATIVE("Всего по МВЗ",0)
)

FIXPARALLEL(8,@DESCENDANTS("ПОЛНАЯ СЕБЕСТОИМОСТЬ"))
CLEARBLOCK ALL;
ENDFIXPARALLEL

ENDFIX
FIX(
/*МВЗ                             */@LIST("ТЧМ в целом", "ТЧМС в целом") and @RELATIVE({МВЗ},0)
)
FIX(
/*ПРОЧЕЕ                         */"бу прочих справочников"
/*ПРОДУКЦИЯ                       */"бу вида продукции"
/*НАПРАВЛЕНИЕ                       */"бу направления"
/*ЭЛЕМЕНТЫ_ЗАТРАТ                    */"бу элемента затрат"
/*МВЗ ПОЛУЧАТЕЛЬ                    */"бу МВЗ (пол-ль)"
/*ВАЛЮТА                          */"RUR"
/*ПЕРИОД                          */
/*КОНТРАГЕНТЫ                       */"бу контрагента"
/*ВЕРСИЯ                          */{ВЕРСИЯ}
/*ГОД                             */{ГОД}
/*МВЗ                             */
/*СЦЕНАРИЙ                       */{СЦЕНАРИЙ}
/*ВИД ЗАТРАТ                       */@LIST(@DESCENDANTS("Материалы на содержание:"),@DESCENDANTS("Прочие материалы на содержание:")) AND @RELATIVE("Всего по видам затрат",0)
/*ЦФО                             */@RELATIVE({ЦФО},0) and  @LIST("ПЭО","Коммерческая служба")
/*СТАТЬИ                          */"Прочие затраты на содержание"
/*ПОКАЗАТЕЛИ                       */
/*СЧЕТА БАЛАНСА                    */
)


FIX(
/*ПЕРИОД                          */"Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"

)


DATACOPY "10_Списание"->"Кол-во" to "10_Остаток на начало"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "60_ДЗ/КЗ на начало (+/-)"->"Сумма";


ENDFIX 

FIX(
/*ПЕРИОД                          */@RELATIVE("Всего год",0)
)
DATACOPY "10_Списание"->"Кол-во" to "10_Закупка"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "10_Закупка до кор-ки"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "10_Остаток на конец"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "60_Начисление без НДС"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "60_Начисление с НДС"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "60_ДЗ/КЗ на конец (+/-)"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "60_Окончат расчет"->"Сумма";
DATACOPY "10_Списание"->"Кол-во" to "60_Окончат расчет до корректировки"->"Сумма";


FIX(
/*СЧЕТ БАЛАНСА*/
				"10_Списание"
                "10_Закупка до кор-ки"               
                "60_Начисление без НДС"
                
                "60_Начисление с НДС"
                "60_Окончат расчет до корректировки"
                

                

)
"Сумма"(
        IF(@ISMBR("10_Списание") or @ISMBR("10_Закупка до кор-ки") or @ISMBR("60_Начисление без НДС"))
       "Сумма"= "10_Списание"->"Кол-во"*"20_Начисление"->"ПОПУТНАЯ ПРОДУКЦИЯ"->"Цена"; /*цена из формы 6.08*/
        ELSEIF(@ISMBR("60_Начисление с НДС") or @ISMBR("60_Окончат расчет до корректировки"))
         "Сумма"=1.18*"10_Списание"->"Кол-во"*"20_Начисление"->"ПОПУТНАЯ ПРОДУКЦИЯ"->"Цена"; /*цена из формы 6.08*/
      ENDIF 
        )

ENDFIX

FIX(
/*СЧЕТ БАЛАНСА*/

                "10_Закупка"
                "60_Окончат расчет"


                

)
"Сумма"(
      IF(@ISMBR("10_Закупка"))
          IF(@ISMBR(@LIST("Кислота серная техническая","Соль техническая","Железный купорос")))        
          	"Сумма"="10_Закупка до кор-ки"->"Сумма"+"10_Кор-ка суммы закупки"->"Материалы на содержание (ввод)"->"Сумма"*"10_Закупка до кор-ки"->"Сумма"/@SUMRANGE("10_Закупка до кор-ки"->"Сумма",@LIST("Кислота серная техническая","Соль техническая","Железный купорос"));
          ELSE
         	"Сумма"= "10_Закупка до кор-ки"->"Сумма"+"10_Кор-ка суммы закупки"->"Прочие материалы на содержание (ввод):"->"Сумма"*"10_Закупка до кор-ки"->"Сумма"/@SUMRANGE("10_Закупка до кор-ки"->"Сумма",@CHILDREN("Прочие материалы на содержание:"));
          ENDIF
        ELSEIF(@ISMBR("60_Окончат расчет"))
         
         IF(@ISMBR(@LIST("Кислота серная техническая","Соль техническая","Железный купорос")))
             "Сумма"="60_Окончат расчет до корректировки"->"Сумма"+"60_Корректировка оплат"->"Материалы на содержание (ввод)"->"Сумма"*"60_Окончат расчет до корректировки"->"Сумма"/@SUMRANGE("60_Окончат расчет до корректировки"->"Сумма",@LIST("Кислота серная техническая","Соль техническая","Железный купорос"));
              ELSE
             "Сумма"="60_Окончат расчет до корректировки"->"Сумма"+"60_Корректировка оплат"->"Прочие материалы на содержание (ввод):"->"Сумма"*"60_Окончат расчет до корректировки"->"Сумма"/@SUMRANGE("60_Окончат расчет до корректировки"->"Сумма",@CHILDREN("Прочие материалы на содержание:"));
            ENDIF
        
      ENDIF        )


ENDFIX
FIX(
				"10_Остаток на конец"

                "60_ДЗ/КЗ на конец (+/-)"
)                
 "Сумма"(
IF(@ISMBR("10_Остаток на конец"))
    #missing;
    IF(@ISMBR("Январь"))
    "Сумма"->"10_Остаток на начало"+"Сумма"->"10_Закупка"-"Сумма"->"10_Списание";
    ELSE
    "Сумма"->"10_Остаток на начало"->"Январь"
    +(@SUMRANGE("Сумма"->"10_Закупка",@LIST("Январь":@CURRMBR("ПЕРИОД")))-"Сумма"->"10_Закупка")
    - (@SUMRANGE("Сумма"->"10_Списание",@LIST("Январь":@CURRMBR("ПЕРИОД")))-"Сумма"->"10_Списание");
    ENDIF
 ENDIF
)


"Сумма"(
IF(@ISMBR("60_ДЗ/КЗ на конец (+/-)"))
    #missing;
    IF(@ISMBR("Январь"))
    "Сумма"->"60_ДЗ/КЗ на начало (+/-)"+"Сумма"->"60_Начисление с НДС"-"Сумма"->"60_Окончат расчет";
    ELSE
    "Сумма"->"60_ДЗ/КЗ на начало (+/-)"->"Январь"
    +(@SUMRANGE("Сумма"->"60_Начисление с НДС",@LIST("Январь":@CURRMBR("ПЕРИОД")))-"Сумма"->"60_Начисление с НДС")
    - (@SUMRANGE("Сумма"->"60_Окончат расчет",@LIST("Январь":@CURRMBR("ПЕРИОД")))-"Сумма"->"60_Окончат расчет");
    ENDIF
 ENDIF
)
ENDFIX

FIX(
                "10_Остаток на начало"
                "60_ДЗ/КЗ на начало (+/-)"
)

"Сумма"(
IF(@ISMBR("10_Остаток на начало"))
IF(NOT @ISMBR("Январь"))
@PRIOR("Сумма"->"10_Остаток на конец");
ENDIF
ENDIF
)       


"Сумма"(
IF(@ISMBR("60_ДЗ/КЗ на начало (+/-)"))
IF(NOT @ISMBR("Январь"))
@PRIOR("Сумма"->"60_ДЗ/КЗ на конец (+/-)");
ENDIF
ENDIF
)


ENDFIX

ENDFIX

ENDFIX

ENDFIX]]></script>
    </rule>
  </rules>
  <components></components>
</HBRRepo>